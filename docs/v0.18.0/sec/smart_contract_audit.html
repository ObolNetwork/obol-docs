<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-v0.18.0 docs-doc-page docs-doc-id-sec/smart_contract_audit" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Smart Contract Audit | Obol Network</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.obol.org/docs/v0.18.0/sec/smart_contract_audit"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:image" content="/img/obol_og_image.png"><meta data-rh="true" property="og:image:width" content="1200"><meta data-rh="true" property="og:image:height" content="630"><meta data-rh="true" name="docusaurus_version" content="v0.18.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v0.18.0"><meta data-rh="true" name="docsearch:version" content="v0.18.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v0.18.0"><meta data-rh="true" property="og:title" content="Smart Contract Audit | Obol Network"><meta data-rh="true" name="description" content="Smart Contract Audit"><meta data-rh="true" property="og:description" content="Smart Contract Audit"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.obol.org/docs/v0.18.0/sec/smart_contract_audit"><link data-rh="true" rel="alternate" href="https://docs.obol.org/docs/v0.18.0/sec/smart_contract_audit" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.obol.org/docs/v0.18.0/sec/smart_contract_audit" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DTT2S469C4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DTT2S469C4",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dbaa67c0.css">
<script src="/assets/js/runtime~main.b350b374.js" defer="defer"></script>
<script src="/assets/js/main.6f49e9dd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ObolIconDark.svg" alt="Obol Network Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ObolIconLight.svg" alt="Obol Network Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Obol Network</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/v0.18.0/int/Overview">Docs</a><a class="navbar__item navbar__link" href="/api">API</a><a class="navbar__item navbar__link" href="/docs/sdk">SDK</a><a href="https://blog.obol.tech" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/obolnetwork/obol-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/v0.18.0/sec/smart_contract_audit">v0.18.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/sec/smart_contract_audit">Next</a></li><li><a class="dropdown__link" href="/docs/sec/smart_contract_audit">v1.0.0</a></li><li><a class="dropdown__link" href="/docs/v0.19.2/sec/smart_contract_audit">v0.19.2</a></li><li><a class="dropdown__link" href="/docs/v0.19.1/sec/smart_contract_audit">v0.19.1</a></li><li><a class="dropdown__link" href="/docs/v0.19.0/sec/smart_contract_audit">v0.19.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v0.18.0/sec/smart_contract_audit">v0.18.0</a></li><li><a class="dropdown__link" href="/docs/v0.17.1/sec/smart_contract_audit">v0.17.1</a></li><li><a class="dropdown__link" href="/docs/v0.17.0/intro">v0.17.0</a></li><li><a class="dropdown__link" href="/docs/v0.16.0/intro">v0.16.0</a></li><li><a class="dropdown__link" href="/docs/v0.15.0/intro">v0.15.0</a></li><li><a class="dropdown__link" href="/docs/v0.14.4/intro">v0.14.4</a></li><li><a class="dropdown__link" href="/docs/v0.14.0/intro">v0.14.0</a></li><li><a class="dropdown__link" href="/docs/v0.13.0/intro">v0.13.0</a></li><li><a class="dropdown__link" href="/docs/v0.12.0/intro">v0.12.0</a></li><li><a class="dropdown__link" href="/docs/v0.11.0/intro">v0.11.0</a></li><li><a class="dropdown__link" href="/docs/v0.10.1/intro">v0.10.1</a></li><li><a class="dropdown__link" href="/docs/v0.10.0/intro">v0.10.0</a></li><li><a class="dropdown__link" href="/docs/v0.9.0/intro">v0.9.0</a></li><li><a class="dropdown__link" href="/docs/v0.8.1/intro">v0.8.1</a></li><li><a class="dropdown__link" href="/docs/v0.8.0/intro">v0.8.0</a></li><li><a class="dropdown__link" href="/docs/v0.7.0/intro">v0.7.0</a></li><li><a class="dropdown__link" href="/docs/v0.6.1/intro">v0.6.1</a></li><li><a class="dropdown__link" href="/docs/v0.6.0/intro">v0.6.0</a></li><li><a class="dropdown__link" href="/docs/v0.5.0/intro">v0.5.0</a></li><li><a class="dropdown__link" href="/docs/v0.4.0/intro">v0.4.0</a></li><li><a class="dropdown__link" href="/docs/v0.3.0/intro">v0.3.0</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-v0.18.0"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v0.18.0/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/v0.18.0/int/Overview">Getting started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/int/Overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/int/key-concepts">Key concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/v0.18.0/int/quickstart">Quickstart Guides</a><button aria-label="Collapse sidebar category &#x27;Quickstart Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v0.18.0/int/quickstart/alone/test-locally">Create a DV alone</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/v0.18.0/int/quickstart/group">Create a DV as a group</a><button aria-label="Expand sidebar category &#x27;Create a DV as a group&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/int/quickstart/activate-dv">Activate a DV</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/int/quickstart/update">Update a DV</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/int/quickstart/quickstart-exit">Exit a DV</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/int/quickstart/quickstart-mainnet">Run a DV on mainnet</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v0.18.0/int/quickstart/advanced/quickstart-sdk">Advanced Guides</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v0.18.0/int/faq/general">FAQ</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/v0.18.0/charon/intro">Charon</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/charon/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/charon/dkg">Distributed Key Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/charon/cluster-configuration">Cluster configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/charon/networking">Charon networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/charon/charon-cli-reference">CLI reference</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.18.0/dvl/intro">DV Launchpad</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.18.0/sc/introducing-obol-splits">Smart contracts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v0.18.0/testnet">Testnets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/v0.18.0/sec/overview">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/sec/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/sec/bug-bounty">Obol Bug Bounty</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/sec/contact">Contacts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/sec/ev-assessment">Software Development at Obol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v0.18.0/sec/smart_contract_audit">Smart Contract Audit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.18.0/sec/threat_model">Charon threat model</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.18.0/cg/bug-report">Contribution &amp; Feedback</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.18.0/fr/eth">Further reading</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Obol Network<!-- --> <b>v0.18.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/sec/smart_contract_audit">latest version</a></b> (<!-- -->v1.0.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Security</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Smart Contract Audit</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v0.18.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Smart Contract Audit</h1></header>
<table><tr><th></th><th></th></tr><tr><td><img src="https://obol.tech/ObolIcon.png?ref=blog.obol.tech" width="250" height="250"></td><td><h1>Obol Audit Report</h1><h2>Obol Manager Contracts</h2><p>Prepared by: Zach Obront, Independent Security Researcher</p><p>Date: Sept 18 to 22, 2023</p></td></tr></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-obol">About <strong>Obol</strong><a href="#about-obol" class="hash-link" aria-label="Direct link to about-obol" title="Direct link to about-obol">​</a></h2>
<p>The Obol Network is an ecosystem for trust minimized staking that enables people to create, test, run &amp; co-ordinate distributed validators.</p>
<p>The Obol Manager contracts are responsible for distributing validator rewards and withdrawals among the validator and node operators involved in a distributed validator.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-zachobront">About <strong>zachobront</strong><a href="#about-zachobront" class="hash-link" aria-label="Direct link to about-zachobront" title="Direct link to about-zachobront">​</a></h2>
<p>Zach Obront is an independent smart contract security researcher. He serves as a Lead Senior Watson at Sherlock, a Security Researcher at Spearbit, and has identified multiple critical severity bugs in the wild, including in a Top 5 Protocol on Immunefi. You can say hi on Twitter at <a href="http://twitter.com/zachobront" target="_blank" rel="noopener noreferrer">@zachobront</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary--scope">Summary &amp; Scope<a href="#summary--scope" class="hash-link" aria-label="Direct link to Summary &amp; Scope" title="Direct link to Summary &amp; Scope">​</a></h2>
<p>The <a href="https://github.com/ObolNetwork/obol-manager-contracts/" target="_blank" rel="noopener noreferrer">ObolNetwork/obol-manager-contracts</a> repository was audited at commit <a href="https://github.com/ObolNetwork/obol-manager-contracts/tree/50ce277919723c80b96f6353fa8d1f8facda6e0e" target="_blank" rel="noopener noreferrer">50ce277919723c80b96f6353fa8d1f8facda6e0e</a>.</p>
<p>The following contracts were in scope:</p>
<ul>
<li>src/controllers/ImmutableSplitController.sol</li>
<li>src/controllers/ImmutableSplitControllerFactory.sol</li>
<li>src/lido/LidoSplit.sol</li>
<li>src/lido/LidoSplitFactory.sol</li>
<li>src/owr/OptimisticWithdrawalReceiver.sol</li>
<li>src/owr/OptimisticWithdrawalReceiverFactory.sol</li>
</ul>
<p>After completion of the fixes, the <a href="https://github.com/ObolNetwork/obol-manager-contracts/tree/2f4f059bfd145f5f05d794948c918d65d222c3a9" target="_blank" rel="noopener noreferrer">2f4f059bfd145f5f05d794948c918d65d222c3a9</a> commit was reviewed. After this review, the updated Lido fee share system in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/96/files" target="_blank" rel="noopener noreferrer">PR #96</a> was reviewed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-of-findings">Summary of Findings<a href="#summary-of-findings" class="hash-link" aria-label="Direct link to Summary of Findings" title="Direct link to Summary of Findings">​</a></h2>
<table><thead><tr><th style="text-align:center">Identifier</th><th>Title</th><th style="text-align:center">Severity</th><th style="text-align:center">Fixed</th></tr></thead><tbody><tr><td style="text-align:center"><a href="#m-01-future-fees-may-be-skirted-by-setting-a-non-eth-reward-token">M-01</a></td><td>Future fees may be skirted by setting a non-ETH reward token</td><td style="text-align:center">Medium</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#m-02-splits-with-256-or-more-node-operators-will-not-be-able-to-switch-on-fees">M-02</a></td><td>Splits with 256 or more node operators will not be able to switch on fees</td><td style="text-align:center">Medium</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#m-03-in-a-mass-slashing-event-node-operators-are-incentivized-to-get-slashed">M-03</a></td><td>In a mass slashing event, node operators are incentivized to get slashed</td><td style="text-align:center">Medium</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="#l-01-obol-fees-will-be-applied-retroactively-to-all-non-distributed-funds-in-the-splitter">L-01</a></td><td>Obol fees will be applied retroactively to all non-distributed funds in the Splitter</td><td style="text-align:center">Low</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#l-02-if-owr-is-used-with-rebase-tokens-and-theres-a-negative-rebase-principal-can-be-lost">L-02</a></td><td>If OWR is used with rebase tokens and there&#x27;s a negative rebase, principal can be lost</td><td style="text-align:center">Low</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#l-03-lidosplit-can-receive-eth-which-will-be-locked-in-contract">L-03</a></td><td>LidoSplit can receive ETH, which will be locked in contract</td><td style="text-align:center">Low</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#l-04-upgrade-to-latest-version-of-solady-to-fix-libclone-bug">L-04</a></td><td>Upgrade to latest version of Solady to fix LibClone bug</td><td style="text-align:center">Low</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#g-01-steth-and-wsteth-addresses-can-be-saved-on-implementation-to-save-gas">G-01</a></td><td>stETH and wstETH addresses can be saved on implementation to save gas</td><td style="text-align:center">Gas</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#g-02-owr-can-be-simplified-and-save-gas-by-not-tracking-distributedfunds">G-02</a></td><td>OWR can be simplified and save gas by not tracking distributedFunds</td><td style="text-align:center">Gas</td><td style="text-align:center">✓</td></tr><tr><td style="text-align:center"><a href="#i-01-strong-trust-assumptions-between-validators-and-node-operators">I-01</a></td><td>Strong trust assumptions between validators and node operators</td><td style="text-align:center">Informational</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><a href="#i-02-provide-node-operator-checklist-to-validate-setup">I-02</a></td><td>Provide node operator checklist to validate setup</td><td style="text-align:center">Informational</td><td style="text-align:center"></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detailed-findings">Detailed Findings<a href="#detailed-findings" class="hash-link" aria-label="Direct link to Detailed Findings" title="Direct link to Detailed Findings">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="m-01-future-fees-may-be-skirted-by-setting-a-non-eth-reward-token">[M-01] Future fees may be skirted by setting a non-ETH reward token<a href="#m-01-future-fees-may-be-skirted-by-setting-a-non-eth-reward-token" class="hash-link" aria-label="Direct link to [M-01] Future fees may be skirted by setting a non-ETH reward token" title="Direct link to [M-01] Future fees may be skirted by setting a non-ETH reward token">​</a></h3>
<p>Fees are planned to be implemented on the <code>rewardRecipient</code> splitter by updating to a new fee structure using the <code>ImmutableSplitController</code>.</p>
<p>It is assumed that all rewards will flow through the splitter, because (a) all distributed rewards less than 16 ETH are sent to the <code>rewardRecipient</code>, and (b) even if a team waited for rewards to be greater than 16 ETH, rewards sent to the <code>principalRecipient</code> are capped at the <code>amountOfPrincipalStake</code>.</p>
<p>This creates a fairly strong guarantee that reward funds will flow to the <code>rewardRecipient</code>. Even if a user were to set their <code>amountOfPrincipalStake</code> high enough that the <code>principalRecipient</code> could receive unlimited funds, the Obol team could call <code>distributeFunds()</code> when the balance got near 16 ETH to ensure fees were paid.</p>
<p>However, if the user selects a non-ETH token, all ETH will be withdrawable only thorugh the <code>recoverFunds()</code> function. If they set up a split with their node operators as their <code>recoveryAddress</code>, all funds will be withdrawable via <code>recoverFunds()</code> without ever touching the <code>rewardRecipient</code> or paying a fee.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation">Recommendation<a href="#recommendation" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>I would recommend removing the ability to use a non-ETH token from the <code>OptimisticWithdrawalRecipient</code>. Alternatively, if it feels like it may be a use case that is needed, it may make sense to always include ETH as a valid token, in addition to any <code>OWRToken</code> set.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review">Review<a href="#review" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/85" target="_blank" rel="noopener noreferrer">PR 85</a> by removing the ability to use non-ETH tokens.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="m-02-splits-with-256-or-more-node-operators-will-not-be-able-to-switch-on-fees">[M-02] Splits with 256 or more node operators will not be able to switch on fees<a href="#m-02-splits-with-256-or-more-node-operators-will-not-be-able-to-switch-on-fees" class="hash-link" aria-label="Direct link to [M-02] Splits with 256 or more node operators will not be able to switch on fees" title="Direct link to [M-02] Splits with 256 or more node operators will not be able to switch on fees">​</a></h3>
<p>0xSplits is used to distribute rewards across node operators. All Splits are deployed with an ImmutableSplitController, which is given permissions to update the split one time to add a fee for Obol at a future date.</p>
<p>The Factory deploys these controllers as Clones with Immutable Args, hard coding the <code>owner</code>, <code>accounts</code>, <code>percentAllocations</code>, and <code>distributorFee</code> for the future update. This data is packed as follows:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_packSplitControllerData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">calldata</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">calldata</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token plain"> distributorFee</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">internal</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> recipientsSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> recipients </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">recipientsSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> recipientsSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      recipients</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> ADDRESS_BITS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint160</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      unchecked </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    data </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">encodePacked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">splitMain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> distributorFee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">recipientsSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> recipients</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the process, <code>recipientsSize</code> is unsafely downcasted into a <code>uint8</code>, which has a maximum value of <code>256</code>. As a result, any values greater than 256 will overflow and result in a lower value of <code>recipients.length % 256</code> being passed as <code>recipientsSize</code>.</p>
<p>When the Controller is deployed, the full list of <code>percentAllocations</code> is passed to the <code>validSplit</code> check, which will pass as expected. However, later, when <code>updateSplit()</code> is called, the <code>getNewSplitConfiguation()</code> function will only return the first <code>recipientsSize</code> accounts, ignoring the rest.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getNewSplitConfiguration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">pure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// fetch the size first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// then parse the data gradually</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_recipientsSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    accounts </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    percentAllocations </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token plain"> recipient </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">_getRecipient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint160</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">recipient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">recipient </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token plain"> ADDRESS_BITS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      unchecked </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When <code>updateSplit()</code> is eventually called on <code>splitsMain</code> to turn on fees, the <code>validSplit()</code> check on that contract will revert because the sum of the percent allocations will no longer sum to <code>1e6</code>, and the update will not be possible.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept">Proof of Concept<a href="#proof-of-concept" class="hash-link" aria-label="Direct link to Proof of Concept" title="Direct link to Proof of Concept">​</a></h4>
<p>The following test can be dropped into a file in <code>src/test</code> to demonstrate that passing 400 accounts will result in a <code>recipientSize</code> of <code>400 - 256 = 144</code>:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// SPDX-License-Identifier: MIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">pragma</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">solidity</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">^</span><span class="token version number" style="color:rgb(247, 140, 108)">0.8.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> Test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;forge-std/Test.sol&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> console </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;forge-std/console.sol&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ImmutableSplitControllerFactory </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;src/controllers/ImmutableSplitControllerFactory.sol&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ImmutableSplitController </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;src/controllers/ImmutableSplitController.sol&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ISplitsMain</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">calldata</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">calldata</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token plain"> distributorFee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">external</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">contract</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ZachTest</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">is</span><span class="token plain"> Test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">testZach_RecipientSizeCappedAt256Accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createSelectFork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://mainnet.infura.io/v3/fb419f740b7e401bad5bec77d0d285a5&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ImmutableSplitControllerFactory factory </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ImmutableSplitControllerFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">9999</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes32</span><span class="token plain"> deploymentSalt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">keccak256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">encodePacked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1102</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> owner </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> bigAccounts </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">400</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> bigPercentAllocations </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">400</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">400</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            bigAccounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint160</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            bigPercentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// confirmation that 0xSplits will allow creating a split with this many accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// dummy acct passed as controller, but doesn&#x27;t matter for these purposes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> split </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ISplitsMain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0x2ed6c4B5dA6378c7897AC67Ba9e43102Feb694EE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bigAccounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bigPercentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">8888</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ImmutableSplitController controller </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> factory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bigAccounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bigPercentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deploymentSalt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// added a public function to controller to read recipient size directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint</span><span class="token plain"> savedRecipientSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ZachTest__recipientSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">savedRecipientSize </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">400</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">savedRecipientSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 144</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-1">Recommendation<a href="#recommendation-1" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>When packing the data in <code>_packSplitControllerData()</code>, check <code>recipientsSize</code> before downcasting to a uint8:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">function _packSplitControllerData(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address owner,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address[] calldata accounts,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint32[] calldata percentAllocations,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint32 distributorFee</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) internal view returns (bytes memory data) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 recipientsSize = accounts.length;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+   if (recipientsSize &gt; 256) revert InvalidSplit__TooManyAccounts(recipientSize);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-1">Review<a href="#review-1" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed as recommended in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/86" target="_blank" rel="noopener noreferrer">PR 86</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="m-03-in-a-mass-slashing-event-node-operators-are-incentivized-to-get-slashed">[M-03] In a mass slashing event, node operators are incentivized to get slashed<a href="#m-03-in-a-mass-slashing-event-node-operators-are-incentivized-to-get-slashed" class="hash-link" aria-label="Direct link to [M-03] In a mass slashing event, node operators are incentivized to get slashed" title="Direct link to [M-03] In a mass slashing event, node operators are incentivized to get slashed">​</a></h3>
<p>When the <code>OptimisticWithdrawalRecipient</code> receives funds from the beacon chain, it uses the following rule to determine the allocation:</p>
<blockquote>
<p>If the amount of funds to be distributed is greater than or equal to 16 ether, it is assumed that it is a withdrawal (to be returned to the principal, with a cap on principal withdrawals of the total amount they deposited).</p>
</blockquote>
<blockquote>
<p>Otherwise, it is assumed that the funds are rewards.</p>
</blockquote>
<p>This value being as low as 16 ether protects against any predictable attack the node operator could perform. For example, due to the effect of hysteresis in updating effective balances, it does not seem to be possible for node operators to predictably bleed a withdrawal down to be below 16 ether (even if they timed a slashing perfectly).</p>
<p>However, in the event of a mass slashing event, slashing punishments can be much more severe than they otherwise would be. To calculate the size of a slash, we:</p>
<ul>
<li>take the total percentage of validator stake slashed in the 18 days preceding and following a user&#x27;s slash</li>
<li>multiply this percentage by 3 (capped at 100%)</li>
<li>the full slashing penalty for a given validator equals 1/32 of their stake, plus the resulting percentage above applied to the remaining 31/32 of their stake</li>
</ul>
<p>In order for such penalties to bring the withdrawal balance below 16 ether (assuming a full 32 ether to start), we would need the percentage taken to be greater than <code>15 / 31 = 48.3%</code>, which implies that <code>48.3 / 3 = 16.1%</code> of validators would need to be slashed.</p>
<p>Because the measurement is taken from the 18 days before and after the incident, node operators would have the opportunity to see a mass slashing event unfold, and later decide that they would like to be slashed along with it.</p>
<p>In the event that they observed that greater than 16.1% of validators were slashed, Obol node operators would be able to get themselves slashed, be exited with a withdrawal of less than 16 ether, and claim that withdrawal as rewards, effectively stealing from the principal recipient.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendations">Recommendations<a href="#recommendations" class="hash-link" aria-label="Direct link to Recommendations" title="Direct link to Recommendations">​</a></h4>
<p>Find a solution that provides a higher level of guarantee that the funds withdrawn are actually rewards, and not a withdrawal.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-2">Review<a href="#review-2" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Acknowledged. We believe this is a black swan event. It would require a major ETH client to be compromised, and would be a betrayal of trust, so likely not EV+ for doxxed operators. Users of this contract with unknown operators should be wary of such a risk.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l-01-obol-fees-will-be-applied-retroactively-to-all-non-distributed-funds-in-the-splitter">[L-01] Obol fees will be applied retroactively to all non-distributed funds in the Splitter<a href="#l-01-obol-fees-will-be-applied-retroactively-to-all-non-distributed-funds-in-the-splitter" class="hash-link" aria-label="Direct link to [L-01] Obol fees will be applied retroactively to all non-distributed funds in the Splitter" title="Direct link to [L-01] Obol fees will be applied retroactively to all non-distributed funds in the Splitter">​</a></h3>
<p>When Obol decides to turn on fees, a call will be made to <code>ImmutableSplitController::updateSplit()</code>, which will take the predefined split parameters (the original user specified split with Obol&#x27;s fees added in) and call <code>updateSplit()</code> to implement the change.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">updateSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">external</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">payable</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sender </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">revert</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Unauthorized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getNewSplitConfiguration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">ISplitMain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">splitMain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">updateSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">distributorFee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If we look at the code on <code>SplitsMain</code>, we can see that this <code>updateSplit()</code> function is applied retroactively to all funds that are already in the split, because it updates the parameters without performing a distribution first:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">updateSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">calldata</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">calldata</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token plain"> distributorFee</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">external</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">onlySplitController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">validSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> distributorFee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">_updateSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">split</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> accounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> percentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> distributorFee</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means that any funds that have been sent to the split but have not yet be distributed will be subject to the Obol fee. Since these splitters will be accumulating all execution layer fees, it is possible that some of them may have received large MEV bribes, where this after-the-fact fee could be quite expensive.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-2">Recommendation<a href="#recommendation-2" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>The most strict solution would be for the <code>ImmutableSplitController</code> to store both the old split parameters and the new parameters. The old parameters could first be used to call <code>distributeETH()</code> on the split, and then <code>updateSplit()</code> could be called with the new parameters.</p>
<p>If storing both sets of values seems too complex, the alternative would be to require that <code>split.balance &lt;= 1</code> to update the split. Then the Obol team could simply store the old parameters off chain to call <code>distributeETH()</code> on each split to &quot;unlock&quot; it to update the fees.</p>
<p>(Note that for the second solution, the ETH balance should be less than or equal to 1, not 0, because 0xSplits stores empty balances as <code>1</code> for gas savings.)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-3">Review<a href="#review-3" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed as recommended in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/86" target="_blank" rel="noopener noreferrer">PR 86</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l-02-if-owr-is-used-with-rebase-tokens-and-theres-a-negative-rebase-principal-can-be-lost">[L-02] If OWR is used with rebase tokens and there&#x27;s a negative rebase, principal can be lost<a href="#l-02-if-owr-is-used-with-rebase-tokens-and-theres-a-negative-rebase-principal-can-be-lost" class="hash-link" aria-label="Direct link to [L-02] If OWR is used with rebase tokens and there&#x27;s a negative rebase, principal can be lost" title="Direct link to [L-02] If OWR is used with rebase tokens and there&#x27;s a negative rebase, principal can be lost">​</a></h3>
<p>The <code>OptimisticWithdrawalRecipient</code> is deployed with a specific token immutably set on the clone. It is presumed that that token will usually be ETH, but it can also be an ERC20 to account for future integrations with tokenized versions of ETH.</p>
<p>In the event that one of these integrations used a rebasing version of ETH (like <code>stETH</code>), the architecture would need to be set up as follows:</p>
<p><code>OptimisticWithdrawalRecipient =&gt; rewards to something like LidoSplit.sol =&gt; Split Wallet</code></p>
<p>In this case, the OWR would need to be able to handle rebasing tokens.</p>
<p>In the event that rebasing tokens are used, there is the risk that slashing or inactivity leads to a period with a negative rebase. In this case, the following chain of events could happen:</p>
<ul>
<li><code>distribute(PULL)</code> is called, setting <code>fundsPendingWithdrawal == balance</code></li>
<li>rebasing causes the balance to decrease slightly</li>
<li><code>distribute(PULL)</code> is called again, so when <code>fundsToBeDistributed = balance - fundsPendingWithdrawal</code> is calculated in an unchecked block, it ends up being near <code>type(uint256).max</code></li>
<li>since this is more than <code>16 ether</code>, the first <code>amountOfPrincipalStake - _claimedPrincipalFunds</code> will be allocated to the principal recipient, and the rest to the reward recipient</li>
<li>we check that <code>endingDistributedFunds &lt;= type(uint128).max</code>, but unfortunately this check misses the issue, because only <code>fundsToBeDistributed</code> underflows, not <code>endingDistributedFunds</code></li>
<li><code>_claimedPrincipalFunds</code> is set to <code>amountOfPrincipalStake</code>, so all future claims will go to the reward recipient</li>
<li>the <code>pullBalances</code> for both recipients will be set higher than the balance of the contract, and so will be unusable</li>
</ul>
<p>In this situation, the only way for the principal to get their funds back would be for the full <code>amountOfPrincipalStake</code> to hit the contract at once, and for them to call <code>withdraw()</code> before anyone called <code>distribute(PUSH)</code>. If anyone was to be able to call <code>distribute(PUSH)</code> before them, all principal would be sent to the reward recipient instead.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-3">Recommendation<a href="#recommendation-3" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>Similar to #74, I would recommend removing the ability for the <code>OptimisticWithdrawalRecipient</code> to accept non-ETH tokens.</p>
<p>Otherwise, I would recommend two changes for redundant safety:</p>
<ol>
<li>
<p>Do not allow the OWR to be used with rebasing tokens.</p>
</li>
<li>
<p>Move the <code>_fundsToBeDistributed = _endingDistributedFunds - _startingDistributedFunds;</code> out of the unchecked block. The case where <code>_endingDistributedFunds</code> underflows is already handled by a later check, so this one change should be sufficient to prevent any risk of this issue.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-4">Review<a href="#review-4" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/85" target="_blank" rel="noopener noreferrer">PR 85</a> by removing the ability to use non-ETH tokens.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l-03-lidosplit-can-receive-eth-which-will-be-locked-in-contract">[L-03] LidoSplit can receive ETH, which will be locked in contract<a href="#l-03-lidosplit-can-receive-eth-which-will-be-locked-in-contract" class="hash-link" aria-label="Direct link to [L-03] LidoSplit can receive ETH, which will be locked in contract" title="Direct link to [L-03] LidoSplit can receive ETH, which will be locked in contract">​</a></h3>
<p>Each new <code>LidoSplit</code> is deployed as a clone, which comes with a <code>receive()</code> function for receiving ETH.</p>
<p>However, the only function on <code>LidoSplit</code> is <code>distribute()</code>, which converts <code>stETH</code> to <code>wstETH</code> and transfers it to the <code>splitWallet</code>.</p>
<p>While this contract should only be used for Lido to pay out rewards (which will come in <code>stETH</code>), it seems possible that users may accidentally use the same contract to receive other validator rewards (in ETH), or that Lido governance may introduce ETH payments in the future, which would cause the funds to be locked.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept-1">Proof of Concept<a href="#proof-of-concept-1" class="hash-link" aria-label="Direct link to Proof of Concept" title="Direct link to Proof of Concept">​</a></h4>
<p>The following test can be dropped into <code>LidoSplit.t.sol</code> to confirm that the clones can currently receive ETH:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">testZach_CanReceiveEth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint</span><span class="token plain"> before </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lidoSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">balance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">payable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lidoSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> ether</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">assertEq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lidoSplit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">balance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> before </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> ether</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-4">Recommendation<a href="#recommendation-4" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>Introduce an additional function to <code>LidoSplit.sol</code> which wraps ETH into stETH before calling <code>distribute()</code>, in order to rescue any ETH accidentally sent to the contract.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-5">Review<a href="#review-5" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/87/files" target="_blank" rel="noopener noreferrer">PR 87</a> by adding a <code>rescueFunds()</code> function that can send ETH or any ERC20 (except <code>stETH</code> or <code>wstETH</code>) to the <code>splitWallet</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l-04-upgrade-to-latest-version-of-solady-to-fix-libclone-bug">[L-04] Upgrade to latest version of Solady to fix LibClone bug<a href="#l-04-upgrade-to-latest-version-of-solady-to-fix-libclone-bug" class="hash-link" aria-label="Direct link to [L-04] Upgrade to latest version of Solady to fix LibClone bug" title="Direct link to [L-04] Upgrade to latest version of Solady to fix LibClone bug">​</a></h3>
<p>In the recent <a href="https://github.com/Vectorized/solady/blob/main/audits/cantina-solady-report.pdf" target="_blank" rel="noopener noreferrer">Solady audit</a>, an issue was found the affects LibClone.</p>
<p>In short, LibClone assumes that the length of the immutable arguments on the clone will fit in 2 bytes. If it&#x27;s larger, it overlaps other op codes and can lead to strange behaviors, including causing the deployment to fail or causing the deployment to succeed with no resulting bytecode.</p>
<p>Because the <code>ImmutableSplitControllerFactory</code> allows the user to input arrays of any length that will be encoded as immutable arguments on the Clone, we can manipulate the length to accomplish these goals.</p>
<p>Fortunately, failed deployments or empty bytecode (which causes a revert when <code>init()</code> is called) are not problems in this case, as the transactions will fail, and it can only happen with unrealistically long arrays that would only be used by malicious users.</p>
<p>However, it is difficult to be sure how else this risk might be exploited by using the overflow to jump to later op codes, and it is recommended to update to a newer version of Solady where the issue has been resolved.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="proof-of-concept-2">Proof of Concept<a href="#proof-of-concept-2" class="hash-link" aria-label="Direct link to Proof of Concept" title="Direct link to Proof of Concept">​</a></h4>
<p>If we comment out the <code>init()</code> call in the <code>createController()</code> call, we can see that the following test &quot;successfully&quot; deploys the controller, but the result is that there is no bytecode:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">testZach__CreateControllerSoladyBug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ImmutableSplitControllerFactory factory </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ImmutableSplitControllerFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">9999</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">bytes32</span><span class="token plain"> deploymentSalt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">keccak256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">encodePacked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1102</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> owner </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> bigAccounts </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">28672</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin" style="color:rgb(130, 170, 255)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">memory</span><span class="token plain"> bigPercentAllocations </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">28672</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">28672</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bigAccounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint160</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> bigPercentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">820</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> bigPercentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">34</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ImmutableSplitController controller </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> factory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createController</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">8888</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bigAccounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bigPercentAllocations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deploymentSalt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">assert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-5">Recommendation<a href="#recommendation-5" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>Delete Solady and clone it from the most recent commit, or any commit after the fixes from <a href="https://github.com/Vectorized/solady/pull/548/files#diff-27a3ba4730de4b778ecba4697ab7dfb9b4f30f9e3666d1e5665b194fe6c9ae45" target="_blank" rel="noopener noreferrer">PR #548</a> were merged.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-6">Review<a href="#review-6" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Solady has been updated to v.0.0.123 in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/88" target="_blank" rel="noopener noreferrer">PR 88</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="g-01-steth-and-wsteth-addresses-can-be-saved-on-implementation-to-save-gas">[G-01] stETH and wstETH addresses can be saved on implementation to save gas<a href="#g-01-steth-and-wsteth-addresses-can-be-saved-on-implementation-to-save-gas" class="hash-link" aria-label="Direct link to [G-01] stETH and wstETH addresses can be saved on implementation to save gas" title="Direct link to [G-01] stETH and wstETH addresses can be saved on implementation to save gas">​</a></h3>
<p>The <code>LidoSplitFactory</code> contract holds two immutable values for the addresses of the <code>stETH</code> and <code>wstETH</code> tokens.</p>
<p>When new clones are deployed, these values are encoded as immutable args. This adds the values to the contract code of the clone, so that each time a call is made, they are passed as calldata along to the implementation, which reads the values from the calldata for use.</p>
<p>Since these values will be consistent across all clones on the same chain, it would be more gas efficient to store them in the implementation directly, which can be done with <code>immutable</code> storage values, set in the constructor.</p>
<p>This would save 40 bytes of calldata on each call to the clone, which leads to a savings of approximately 640 gas on each call.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-6">Recommendation<a href="#recommendation-6" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<ol>
<li>Add the following to <code>LidoSplit.sol</code>:</li>
</ol>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> immutable </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> stETH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin" style="color:rgb(130, 170, 255)">address</span><span class="token plain"> immutable </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> wstETH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>
<p>Add a constructor to <code>LidoSplit.sol</code> which sets these immutable values. Solidity treats immutable values as constants and stores them directly in the contract bytecode, so they will be accessible from the clones.</p>
</li>
<li>
<p>Remove <code>stETH</code> and <code>wstETH</code> from <code>LidoSplitFactory.sol</code>, both as storage values, arguments to the constructor, and arguments to <code>clone()</code>.</p>
</li>
<li>
<p>Adjust the <code>distribute()</code> function in <code>LidoSplit.sol</code> to read the storage values for these two addresses, and remove the helper functions to read the clone&#x27;s immutable arguments for these two values.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-7">Review<a href="#review-7" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed as recommended in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/87" target="_blank" rel="noopener noreferrer">PR 87</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="g-02-owr-can-be-simplified-and-save-gas-by-not-tracking-distributedfunds">[G-02] OWR can be simplified and save gas by not tracking distributedFunds<a href="#g-02-owr-can-be-simplified-and-save-gas-by-not-tracking-distributedfunds" class="hash-link" aria-label="Direct link to [G-02] OWR can be simplified and save gas by not tracking distributedFunds" title="Direct link to [G-02] OWR can be simplified and save gas by not tracking distributedFunds">​</a></h3>
<p>Currently, the <code>OptimisticWithdrawalRecipient</code> contract tracks four variables:</p>
<ul>
<li>distributedFunds: total amount of the token distributed via push or pull</li>
<li>fundsPendingWithdrawal: total balance distributed via pull that haven&#x27;t been claimed yet</li>
<li>claimedPrincipalFunds: total amount of funds claimed by the principal recipient</li>
<li>pullBalances: individual pull balances that haven&#x27;t been claimed yet</li>
</ul>
<p>When <code>_distributeFunds()</code> is called, we perform the following math (simplified to only include relevant updates):</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">endingDistributedFunds </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> distributedFunds </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> fundsPendingWithdrawal </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> currentBalance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fundsToBeDistributed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> endingDistributedFunds </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> distributedFunds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">distributedFunds </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> endingDistributedFunds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As we can see, <code>distributedFunds</code> is added to the <code>endingDistributedFunds</code> variable and then removed when calculating <code>fundsToBeDistributed</code>, having no impact on the resulting <code>fundsToBeDistributed</code> value.</p>
<p>The <code>distributedFunds</code> variable is not read or used anywhere else on the contract.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="recommendation-7">Recommendation<a href="#recommendation-7" class="hash-link" aria-label="Direct link to Recommendation" title="Direct link to Recommendation">​</a></h4>
<p>We can simplify the math and save substantial gas (a storage write plus additional operations) by not tracking this value at all.</p>
<p>This would allow us to calculate <code>fundsToBeDistributed</code> directly, as follows:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#243D42"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fundsToBeDistributed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> currentBalance </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> fundsPendingWithdrawal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-8">Review<a href="#review-8" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Fixed as recommended in <a href="https://github.com/ObolNetwork/obol-manager-contracts/pull/85" target="_blank" rel="noopener noreferrer">PR 85</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="i-01-strong-trust-assumptions-between-validators-and-node-operators">[I-01] Strong trust assumptions between validators and node operators<a href="#i-01-strong-trust-assumptions-between-validators-and-node-operators" class="hash-link" aria-label="Direct link to [I-01] Strong trust assumptions between validators and node operators" title="Direct link to [I-01] Strong trust assumptions between validators and node operators">​</a></h3>
<p>It is assumed that validators and node operators will always act in the best interest of the group, rather than in their selfish best interest.</p>
<p>It is important to make clear to users that there are strong trust assumptions between the various parties involved in the DVT.</p>
<p>Here are a select few examples of attacks that a malicious set of node operators could perform:</p>
<ol>
<li>
<p>Since there is currently no mechanism for withdrawals besides the consensus of the node operators, a minority of them sufficient to withhold consensus could blackmail the principal for a payment of up to 16 ether in order to allow them to withdraw. Otherwise, they could turn off their node operators and force the principal to bleed down to a final withdrawn balance of just over 16 ether.</p>
</li>
<li>
<p>Node operators are all able to propose blocks within the P2P network, which are then propogated out to the rest of the network. Node software is accustomed to signing for blocks built by block builders based on the metadata including quantity of fees and the address they&#x27;ll be sent to. This is enforced by social consensus, with block builders not wanting to harm validators in order to have their blocks accepted in the future. However, node operators in a DVT are not concerned with the social consensus of the network, and could therefore build blocks that include large MEV payments to their personal address (instead of the DVT&#x27;s 0xSplit), add fictious metadata to the block header, have their fellow node operators accept the block, and take the MEV for themselves.</p>
</li>
<li>
<p>While the withdrawal address is immutably set on the beacon chain to the OWR, the fee address is added by the nodes to each block. Any majority of node operators sufficient to reach consensus could create a new 0xSplit with only themselves on it, and use that for all execution layer fees. The principal (and other node operators) would not be able to stop them or withdraw their principal, and would be stuck with staked funds paying fees to the malicious node operators.</p>
</li>
</ol>
<p>Note that there are likely many other possible attacks that malicious node operators could perform. This report is intended to demonstrate some examples of the trust level that is needed between validators and node operators, and to emphasize the importance of making these assumptions clear to users.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-9">Review<a href="#review-9" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Acknowledged. We believe EIP 7002 will reduce this trust assumption as it would enable the validator exit via the execution layer withdrawal key.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="i-02-provide-node-operator-checklist-to-validate-setup">[I-02] Provide node operator checklist to validate setup<a href="#i-02-provide-node-operator-checklist-to-validate-setup" class="hash-link" aria-label="Direct link to [I-02] Provide node operator checklist to validate setup" title="Direct link to [I-02] Provide node operator checklist to validate setup">​</a></h3>
<p>There are a number of ways that the user setting up the DVT could plant backdoors to harm the other users involved in the DVT.</p>
<p>Each of these risks is possible to check before signing off on the setup, but some are rather hidden, so it would be useful for the protocol to provide a list of checks that node operators should do before signing off on the setup parameters (or, even better, provide these checks for them through the front end).</p>
<ol>
<li>
<p>Confirm that <code>SplitsMain.getHash(split)</code> matches the hash of the parameters that the user is expecting to be used.</p>
</li>
<li>
<p>Confirm that the controller clone delegates to the correct implementation. If not, it could be pointed to delegate to <code>SplitMain</code> and then called to <code>transferControl()</code> to a user&#x27;s own address, allowing them to update the split arbitrarily.</p>
</li>
<li>
<p><code>OptimisticWithdrawalRecipient.getTranches()</code> should be called to check that <code>amountOfPrincipalStake</code> is equal to the amount that they will actually be providing.</p>
</li>
<li>
<p>The controller&#x27;s <code>owner</code> and future split including Obol fees should be provided to the user. They should be able to check that <code>ImmutableSplitControllerFactory.predictSplitControllerAddress()</code>, with those parameters inputted, results in the controller that is actually listed on <code>SplitsMain.getController(split)</code>.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="review-10">Review<a href="#review-10" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review">​</a></h4>
<p>Acknowledged. We do some of these already (will add the remainder) automatically in the launchpad UI during the cluster confirmation phase by the node operator. We will also add it in markdown to the repo.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ObolNetwork/obol-docs/edit/main/versioned_docs/version-v0.18.0/sec/smart_contract_audit.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v0.18.0/sec/ev-assessment"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Software Development at Obol</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v0.18.0/sec/threat_model"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Charon threat model</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-obol" class="table-of-contents__link toc-highlight">About <strong>Obol</strong></a></li><li><a href="#about-zachobront" class="table-of-contents__link toc-highlight">About <strong>zachobront</strong></a></li><li><a href="#summary--scope" class="table-of-contents__link toc-highlight">Summary &amp; Scope</a></li><li><a href="#summary-of-findings" class="table-of-contents__link toc-highlight">Summary of Findings</a></li><li><a href="#detailed-findings" class="table-of-contents__link toc-highlight">Detailed Findings</a><ul><li><a href="#m-01-future-fees-may-be-skirted-by-setting-a-non-eth-reward-token" class="table-of-contents__link toc-highlight">[M-01] Future fees may be skirted by setting a non-ETH reward token</a></li><li><a href="#m-02-splits-with-256-or-more-node-operators-will-not-be-able-to-switch-on-fees" class="table-of-contents__link toc-highlight">[M-02] Splits with 256 or more node operators will not be able to switch on fees</a></li><li><a href="#m-03-in-a-mass-slashing-event-node-operators-are-incentivized-to-get-slashed" class="table-of-contents__link toc-highlight">[M-03] In a mass slashing event, node operators are incentivized to get slashed</a></li><li><a href="#l-01-obol-fees-will-be-applied-retroactively-to-all-non-distributed-funds-in-the-splitter" class="table-of-contents__link toc-highlight">[L-01] Obol fees will be applied retroactively to all non-distributed funds in the Splitter</a></li><li><a href="#l-02-if-owr-is-used-with-rebase-tokens-and-theres-a-negative-rebase-principal-can-be-lost" class="table-of-contents__link toc-highlight">[L-02] If OWR is used with rebase tokens and there&#39;s a negative rebase, principal can be lost</a></li><li><a href="#l-03-lidosplit-can-receive-eth-which-will-be-locked-in-contract" class="table-of-contents__link toc-highlight">[L-03] LidoSplit can receive ETH, which will be locked in contract</a></li><li><a href="#l-04-upgrade-to-latest-version-of-solady-to-fix-libclone-bug" class="table-of-contents__link toc-highlight">[L-04] Upgrade to latest version of Solady to fix LibClone bug</a></li><li><a href="#g-01-steth-and-wsteth-addresses-can-be-saved-on-implementation-to-save-gas" class="table-of-contents__link toc-highlight">[G-01] stETH and wstETH addresses can be saved on implementation to save gas</a></li><li><a href="#g-02-owr-can-be-simplified-and-save-gas-by-not-tracking-distributedfunds" class="table-of-contents__link toc-highlight">[G-02] OWR can be simplified and save gas by not tracking distributedFunds</a></li><li><a href="#i-01-strong-trust-assumptions-between-validators-and-node-operators" class="table-of-contents__link toc-highlight">[I-01] Strong trust assumptions between validators and node operators</a></li><li><a href="#i-02-provide-node-operator-checklist-to-validate-setup" class="table-of-contents__link toc-highlight">[I-02] Provide node operator checklist to validate setup</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/int/Overview">Intro to Obol</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/charon/intro">Charon</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dvl/intro">DV Launchpad</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/n6ebKsX46w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/obolnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.obol.tech/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/obolnetwork/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://obol.tech/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/ObolLineWhite.svg" alt="Obol Network Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30px" height="30px"><img src="/img/ObolLineWhite.svg" alt="Obol Network Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30px" height="30px"></a></div><div class="footer__copyright">Copyright © 2024 Obol Labs, Inc. </div></div></div></footer></div>
</body>
</html>