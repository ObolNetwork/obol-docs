<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-v0.14.4 docs-doc-page docs-doc-id-charon/networking" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Charon networking | Obol Network</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.obol.org/docs/v0.14.4/charon/networking"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:image" content="/img/obol_og_image.png"><meta data-rh="true" property="og:image:width" content="1200"><meta data-rh="true" property="og:image:height" content="630"><meta data-rh="true" name="docusaurus_version" content="v0.14.4"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v0.14.4"><meta data-rh="true" name="docsearch:version" content="v0.14.4"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v0.14.4"><meta data-rh="true" property="og:title" content="Charon networking | Obol Network"><meta data-rh="true" name="description" content="Networking"><meta data-rh="true" property="og:description" content="Networking"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.obol.org/docs/v0.14.4/charon/networking"><link data-rh="true" rel="alternate" href="https://docs.obol.org/docs/v0.14.4/charon/networking" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.obol.org/docs/v0.14.4/charon/networking" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DTT2S469C4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DTT2S469C4",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dbaa67c0.css">
<script src="/assets/js/runtime~main.b350b374.js" defer="defer"></script>
<script src="/assets/js/main.6f49e9dd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ObolIconDark.svg" alt="Obol Network Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/ObolIconLight.svg" alt="Obol Network Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Obol Network</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/v0.14.4/int/Overview">Docs</a><a class="navbar__item navbar__link" href="/api">API</a><a class="navbar__item navbar__link" href="/docs/sdk">SDK</a><a href="https://blog.obol.tech" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/obolnetwork/obol-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/v0.14.4/charon/networking">v0.14.4</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/charon/networking">Next</a></li><li><a class="dropdown__link" href="/docs/charon/networking">v1.0.0</a></li><li><a class="dropdown__link" href="/docs/v0.19.2/charon/networking">v0.19.2</a></li><li><a class="dropdown__link" href="/docs/v0.19.1/charon/networking">v0.19.1</a></li><li><a class="dropdown__link" href="/docs/v0.19.0/charon/networking">v0.19.0</a></li><li><a class="dropdown__link" href="/docs/v0.18.0/charon/networking">v0.18.0</a></li><li><a class="dropdown__link" href="/docs/v0.17.1/charon/networking">v0.17.1</a></li><li><a class="dropdown__link" href="/docs/v0.17.0/charon/networking">v0.17.0</a></li><li><a class="dropdown__link" href="/docs/v0.16.0/charon/networking">v0.16.0</a></li><li><a class="dropdown__link" href="/docs/v0.15.0/charon/networking">v0.15.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v0.14.4/charon/networking">v0.14.4</a></li><li><a class="dropdown__link" href="/docs/v0.14.0/charon/networking">v0.14.0</a></li><li><a class="dropdown__link" href="/docs/v0.13.0/intro">v0.13.0</a></li><li><a class="dropdown__link" href="/docs/v0.12.0/intro">v0.12.0</a></li><li><a class="dropdown__link" href="/docs/v0.11.0/intro">v0.11.0</a></li><li><a class="dropdown__link" href="/docs/v0.10.1/intro">v0.10.1</a></li><li><a class="dropdown__link" href="/docs/v0.10.0/intro">v0.10.0</a></li><li><a class="dropdown__link" href="/docs/v0.9.0/intro">v0.9.0</a></li><li><a class="dropdown__link" href="/docs/v0.8.1/intro">v0.8.1</a></li><li><a class="dropdown__link" href="/docs/v0.8.0/intro">v0.8.0</a></li><li><a class="dropdown__link" href="/docs/v0.7.0/intro">v0.7.0</a></li><li><a class="dropdown__link" href="/docs/v0.6.1/intro">v0.6.1</a></li><li><a class="dropdown__link" href="/docs/v0.6.0/intro">v0.6.0</a></li><li><a class="dropdown__link" href="/docs/v0.5.0/intro">v0.5.0</a></li><li><a class="dropdown__link" href="/docs/v0.4.0/intro">v0.4.0</a></li><li><a class="dropdown__link" href="/docs/v0.3.0/intro">v0.3.0</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-v0.14.4"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v0.14.4/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/v0.14.4/int/Overview">Getting started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/Overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/key-concepts">Key concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/v0.14.4/int/quickstart">Quickstart Guides</a><button aria-label="Collapse sidebar category &#x27;Quickstart Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/v0.14.4/int/quickstart/group">Run a cluster with others</a><button aria-label="Expand sidebar category &#x27;Run a cluster with others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/quickstart/quickstart-alone">Run a cluster alone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/quickstart/quickstart-builder-api">Run a cluster with MEV-Boost</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/quickstart/quickstart-cli">Run a cluster using the CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/quickstart/quickstart-split">Split existing validator keys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/quickstart/quickstart-combine">Combine DV keyshares</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/int/quickstart/quickstart-exit">Exit a validator</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/v0.14.4/int/faq/general">FAQ</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/v0.14.4/charon/intro">Charon</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/charon/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/charon/dkg">Distributed Key Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/charon/cluster-configuration">Cluster configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v0.14.4/charon/networking">Charon networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v0.14.4/charon/charon-cli-reference">CLI reference</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.14.4/dvl/intro">DV Launchpad</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.14.4/sc/introducing-obol-managers">Smart contracts</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/v0.14.4/testnet">Testnets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.14.4/sec/overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.14.4/cg/bug-report">Contribution guidelines</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/v0.14.4/fr/eth">Further reading</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Obol Network<!-- --> <b>v0.14.4</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/charon/networking">latest version</a></b> (<!-- -->v1.0.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Charon</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Charon networking</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v0.14.4</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Charon networking</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This document describes Charon&#x27;s networking model which can be divided into two parts: the <a href="#internal-validator-stack"><em>internal validator stack</em></a> and the <a href="#external-p2p-network"><em>external p2p network</em></a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-validator-stack">Internal Validator Stack<a href="#internal-validator-stack" class="hash-link" aria-label="Direct link to Internal Validator Stack" title="Direct link to Internal Validator Stack">​</a></h2>
<img src="/img/InternalValidatorStack.png" alt="Internal Validator Stack" width="50%">
<br>
<p>Charon is a middleware DVT client and is therefore connected to an upstream beacon node and a downstream validator client is connected to it.
Each operator should run the whole validator stack (all 4 client software types), either on the same machine or on different machines. The networking between
the nodes should be private and not exposed to the public internet.</p>
<p>Related Charon configuration flags:</p>
<ul>
<li><code>--beacon-node-endpoints</code>: Connects Charon to one or more beacon nodes.</li>
<li><code>--validator-api-address</code>: Address for Charon to listen on and serve requests from the validator client.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="external-p2p-network">External P2P Network<a href="#external-p2p-network" class="hash-link" aria-label="Direct link to External P2P Network" title="Direct link to External P2P Network">​</a></h2>
<p><img decoding="async" loading="lazy" alt="External P2P Network" src="/assets/images/ExternalP2PNetwork-37e54ca010415d35ddcc5b8e5dee3aec.png" width="2306" height="494" class="img_ev3q">
The Charon clients in a DV cluster are connected to each other via a small p2p network consisting of only the clients in the cluster. Peer IP addresses are
discovered via an external &quot;relay&quot; server. The p2p connections are over the public internet so the charon p2p port must be publicly accessible. Charon leverages
the popular <a href="https://libp2p.io/" target="_blank" rel="noopener noreferrer">libp2p</a> protocol.</p>
<p>Related <a href="/docs/next/charon/charon-cli-reference">Charon configuration flags</a>:</p>
<ul>
<li><code>--p2p-tcp-addresses</code>: Addresses for Charon to listen on and serve p2p requests.</li>
<li><code>--p2p-relays</code>: Connect charon to one or more relay servers.</li>
<li><code>--private-key-file</code>: Private key identifying the charon client.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="libp2p-authentication-and-security">LibP2P Authentication and Security<a href="#libp2p-authentication-and-security" class="hash-link" aria-label="Direct link to LibP2P Authentication and Security" title="Direct link to LibP2P Authentication and Security">​</a></h3>
<p>Each charon client has a secp256k1 private key. The associated public key is encoded into the <a href="/docs/v0.14.4/charon/cluster-configuration#Cluster-Lock-File">cluster lock file</a> to identify the nodes in the cluster.
For ease of use and to align with the Ethereum ecosystem, Charon encodes these public keys in the <a href="https://eips.ethereum.org/EIPS/eip-778" target="_blank" rel="noopener noreferrer">ENR format</a>,
not in <a href="https://docs.libp2p.io/concepts/fundamentals/peers/" target="_blank" rel="noopener noreferrer">libp2p’s Peer ID format</a>.</p>
<p>Charon currently only supports libp2p tcp connections with <a href="https://noiseprotocol.org/" target="_blank" rel="noopener noreferrer">noise</a> security and only accepts incoming libp2p connections from peers defined in the cluster lock.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="libp2p-relays-and-peer-discovery">LibP2P Relays and Peer Discovery<a href="#libp2p-relays-and-peer-discovery" class="hash-link" aria-label="Direct link to LibP2P Relays and Peer Discovery" title="Direct link to LibP2P Relays and Peer Discovery">​</a></h3>
<p>Relays are simple libp2p servers that are publicly accessible supporting the <a href="https://docs.libp2p.io/concepts/nat/circuit-relay/" target="_blank" rel="noopener noreferrer">circuit-relay</a> protocol.
Circuit-relay is a libp2p transport protocol that routes traffic between two peers over a third-party “relay” peer.</p>
<p>Obol hosts a publicly accessible relay at <a href="https://0.relay.obol.tech" target="_blank" rel="noopener noreferrer">https://0.relay.obol.tech</a> and will work with other organisations in the community to host alternatives  Anyone can host their own relay server for their DV cluster.</p>
<p>Each charon node knows which peers are in the cluster from the ENRs in the cluster lock file, but their IP addresses are unknown. By connecting to the same relay,
nodes establish “relay connections” to each other. Once connected via relay they exchange their known public addresses via libp2p’s <a href="https://docs.libp2p.io/concepts/fundamentals/protocols/#identify" target="_blank" rel="noopener noreferrer">identify</a>
protocol. The relay connection is then upgraded to a direct connection. If a node’s public IP changes, nodes once again connect via relay, exchange the new IP, and then connect directly once again.</p>
<p>Note that in order for two peers to discover each other, they must connect to the same relay. Cluster operators should therefore coordinate which relays to use.</p>
<p>Libp2p’s <a href="https://docs.libp2p.io/concepts/fundamentals/protocols/#identify" target="_blank" rel="noopener noreferrer">identify</a> protocol attempts to automatically detect the public IP address of a charon
client without the need to explicitly configure it. If this however fails, the following two configuration flags can be used to explicitly set the publicly advertised
address:</p>
<ul>
<li><code>--p2p-external-ip</code>: Explicitly sets the external IP address.</li>
<li><code>--p2p-external-hostname</code>: Explicitly sets the external DNS host name.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>If a pair of charon clients are not publicly accessible, due to being behind a NAT, they will not be able to upgrade their relay connections to a direct connection.
Even though this is supported, it isn’t recommended as relay connections introduce additional latency and reduced throughput and will result in decreased validator effectiveness
and possible missed block proposals and attestations.</p></div></div>
<p>Libp2p’s circuit-relay connections are end-to-end encrypted, even though relay servers accept connections between nodes from multiple different clusters, relays are merely
routing opaque connections. And since Charon only accepts incoming connections from other peers in its cluster, the use of a relay doesn’t allow connections between clusters.</p>
<p>Only the following three libp2p protocols are established between a charon node and a relay itself:</p>
<ul>
<li><a href="https://docs.libp2p.io/concepts/nat/circuit-relay/" target="_blank" rel="noopener noreferrer">circuit-relay</a>: To establish relay e2e encrypted connections between two peers in a cluster. <br></li>
<li><a href="https://docs.libp2p.io/concepts/fundamentals/protocols/#identify" target="_blank" rel="noopener noreferrer">identify</a>: Auto-detection of public IP addresses to share with other peers in the cluster. <br></li>
<li><a href="https://github.com/ObolNetwork/charon/blob/main/app/peerinfo/peerinfo.go" target="_blank" rel="noopener noreferrer">peerinfo</a>: Exchanges basic application <a href="https://github.com/ObolNetwork/charon/blob/main/app/peerinfo/peerinfopb/v1/peerinfo.proto" target="_blank" rel="noopener noreferrer">metadata</a> for improved operational metrics and observability. <br></li>
</ul>
<p>All other charon protocols are only established between nodes in the same cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scalable-relay-clusters">Scalable Relay Clusters<a href="#scalable-relay-clusters" class="hash-link" aria-label="Direct link to Scalable Relay Clusters" title="Direct link to Scalable Relay Clusters">​</a></h3>
<p>In order for a charon client to connect to a relay, it needs the relay&#x27;s <a href="https://docs.libp2p.io/concepts/fundamentals/addressing/" target="_blank" rel="noopener noreferrer">multiaddr</a> (containing its public key and IP address).
But a single multiaddr can only point to a single relay server which can easily be overloaded if too many clusters connect to it. Charon therefore supports resolving a relay’s multiaddr
via HTTP GET request. Since charon also includes the unique <code>cluster-hash</code> header in this request, the relay provider can use
<a href="https://cloud.google.com/load-balancing/docs/https/traffic-management-global#traffic_steering_header-based_routing" target="_blank" rel="noopener noreferrer">consistent header-based load-balancing</a> to map clusters to one of many relays using a single HTTP address.</p>
<p>The relay supports serving its runtime public multiaddrs via its <code>--http-address</code> flag.</p>
<p>E.g., <a href="https://0.relay.obol.tech" target="_blank" rel="noopener noreferrer">https://0.relay.obol.tech</a> is actually a load-balancer that routes HTTP requests to one of many relays based on the <code>cluster-hash</code> header returning the target relay’s multiaddr
which the charon client then uses to connect to that relay.</p>
<p>The charon <code>--p2p-relays</code> flag therefore supports both multiaddrs as well as HTTP URls.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ObolNetwork/obol-docs/edit/main/versioned_docs/version-v0.14.4/charon/networking.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v0.14.4/charon/cluster-configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cluster configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v0.14.4/charon/charon-cli-reference"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CLI reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#internal-validator-stack" class="table-of-contents__link toc-highlight">Internal Validator Stack</a></li><li><a href="#external-p2p-network" class="table-of-contents__link toc-highlight">External P2P Network</a><ul><li><a href="#libp2p-authentication-and-security" class="table-of-contents__link toc-highlight">LibP2P Authentication and Security</a></li><li><a href="#libp2p-relays-and-peer-discovery" class="table-of-contents__link toc-highlight">LibP2P Relays and Peer Discovery</a></li><li><a href="#scalable-relay-clusters" class="table-of-contents__link toc-highlight">Scalable Relay Clusters</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/int/Overview">Intro to Obol</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/charon/intro">Charon</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/dvl/intro">DV Launchpad</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/n6ebKsX46w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/obolnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.obol.tech/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/obolnetwork/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://obol.tech/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/ObolLineWhite.svg" alt="Obol Network Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30px" height="30px"><img src="/img/ObolLineWhite.svg" alt="Obol Network Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30px" height="30px"></a></div><div class="footer__copyright">Copyright © 2024 Obol Labs, Inc. </div></div></div></footer></div>
</body>
</html>