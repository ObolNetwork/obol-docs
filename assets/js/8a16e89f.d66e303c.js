"use strict";(self.webpackChunkobol_docs=self.webpackChunkobol_docs||[]).push([[26277],{44665:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>d,default:()=>x,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"run/running/quickstart-exit","title":"Exit a DV","description":"Exit a validator 2","source":"@site/docs/run/running/quickstart-exit.mdx","sourceDirName":"run/running","slug":"/run/running/quickstart-exit","permalink":"/next/run/running/quickstart-exit","draft":false,"unlisted":false,"editUrl":"https://github.com/ObolNetwork/obol-docs/edit/main/docs/run/running/quickstart-exit.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"description":"Exit a validator 2"},"sidebar":"tutorialSidebar","previous":{"title":"Claim Rewards","permalink":"/next/run/running/claim-rewards"},"next":{"title":"Create an EigenLayer DV","permalink":"/next/run/integrations/quickstart-eigenpod"}}');var n=t(74848),r=t(28453),s=t(49489),o=t(7227);t(2250);const l={sidebar_position:6,description:"Exit a validator 2"},d="Exit a DV",c={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Exit epoch and withdrawable epoch",id:"exit-epoch-and-withdrawable-epoch",level:2}];function u(e){const a={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.header,{children:(0,n.jsx)(a.h1,{id:"exit-a-dv",children:"Exit a DV"})}),"\n",(0,n.jsx)(a.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsx)(a.p,{children:'Users looking to exit staking entirely and withdraw their full balance back must sign and broadcast a "voluntary exit" message with validator keys which will start the process of exiting from staking. In the case of a DV, Charon nodes need to broadcast a partial exit to the other nodes of the cluster. Once a threshold of partial exits has been received by any node, the full voluntary exit will be sent to the beacon chain. This process will take 27 hours or longer depending on the current length of the exit queue. Once the validator is exited, the principal plus unclaimed rewards will go to the withdrawal address of the validator. Depending on the cluster\'s withdrawal configuration, users can claim their proporiton of principal and rewards.'}),"\n",(0,n.jsx)(a.p,{children:"There are two ways to sign the partial exit and broadcast the full exit. Both the solutions don't require gas."}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Using the Charon\u2019s exit solution"})," - It is an Obol hosted solution which is facilitated by Obol APIs. It provides several benefits such as signing partial exits for multiple validators at once, live monitoring of partial exits status via launchpad and ability to download partial exits and broadcast them later as required. Users don\u2019t have to worry about the intricacies of validator clients. Charon Exit abstracts all the complexity."]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Using the Validator Clients directly"})," - Users can also directly use the validator client that is connected to your Charon client to submit partial exits, as the client only signs a partial exit message using its share of the private key. Charon will combine the partial exit messages from the other operators. Once the threshold is reached, they are submitted to the beacon node. All of this is usually wrapped under a single command and hence users cannot download full exit signatures for broadcasting it later.\nIn this case, users cannot use launchpad to monitor exit status and will have to use grafana to query the partial exit status."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.admonition,{type:"info",children:(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"A threshold of operators need to run the exit command for the exit to succeed. This is the same threshold as is specified during cluster creation."}),"\n",(0,n.jsx)(a.li,{children:(0,n.jsx)(a.strong,{children:"Ensure that all operators within a cluster consistently use either the hosted solution (Charon Exit) or the non-hosted solution (Validator Client Exit). Mixing both solutions within the same cluster\u2014where some operators use Charon Exit while others use Validator Client Exit\u2014is not allowed."})}),"\n",(0,n.jsx)(a.li,{children:"In case of validator client native exits, partial exits can be broadcast by any validator client as long as the threshold for the cluster is reached."}),"\n",(0,n.jsx)(a.li,{children:"If a Charon client restarts after the exit command is run but before the threshold is reached, it will lose the partial exits it has received from the other nodes. If all Charon clients restart and thus all partial exits are lost before the required threshold of exit messages are received, operators will have to rebroadcast their partial exit messages."}),"\n",(0,n.jsxs)(a.li,{children:["All operators need to use the same ",(0,n.jsx)(a.code,{children:"EXIT_EPOCH"})," for the exit to be successful. Assuming you want to exit as soon as possible, the default epochs included in the below commands should be sufficient for the respective network."]}),"\n"]})}),"\n",(0,n.jsx)(a.p,{children:"As per your preferences, choose the correct combination of -"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Network"})," : Mainnet or Holesky"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Exit Type"})," : Hosted (Charon) or Non-hosted (Validator client)"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Validator Quanity"}),": Exit single or Exit all validators"]}),"\n"]}),"\n",(0,n.jsxs)(s.A,{groupId:"validator-clients",children:[(0,n.jsx)(o.A,{value:"Holesky",label:"Holesky",children:(0,n.jsxs)(s.A,{groupId:"charon-exits",children:[(0,n.jsxs)(o.A,{value:"charon",label:"Charon",default:!0,children:[(0,n.jsx)(a.p,{children:"Voluntary exit can be submitted directly through Charon. This approach is validator client agnostic as Charon abstracts validator client's native exit commands underneath."}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"charon-single-all",children:[(0,n.jsxs)(o.A,{value:"charon-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit sign \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--validator-public-key="<VALIDATOR_PUBLIC_KEY>" \\\n--exit-epoch=256\'\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<VALIDATOR_PUBLIC_KEY>"})," with the validator's full pubkey (as visible in Ethereum)."]})]}),(0,n.jsxs)(o.A,{value:"charon-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs partial exits for all validators."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c 'charon exit sign \\\n--beacon-node-endpoints=\"http://lighthouse:5052\" \\\n--all \\\n--exit-epoch=256'\n"})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor the Partial Exits' status"})}),(0,n.jsx)(a.p,{children:"After a threshold of signed partial exits from node operators in the cluster is accumulated, a full (complete) exit can be created.  For example, in the cluster below, only 2 out of 4 clusters have reached the threshold. Operators will have to wait for one more partial exit signature, either from operator 1 or 3 to create a full exit message."}),(0,n.jsx)("img",{src:"/img/PartialExitsStatus.png",alt:"Partial Exit Status"}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 3: Broadcast the full exit"})}),(0,n.jsx)(a.p,{children:"Once the partial exit threshold is reached, a full exit can be broadcasted from any of the operator. There are two options to do it, depending on your use-case"}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Fetch the full exit and broadcast instantaneously (Broadcast directly )"})," - users can choose it for a single validator or all validators in the cluster."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Fetch the full exit and broadcast it later(Fetch & Broadcast later )"})," - users can choose it for a single validator or all validators in the cluster."]}),"\n"]}),(0,n.jsxs)(s.A,{groupId:"charon-exit-broadcast-fetch",children:[(0,n.jsx)(o.A,{value:"charon-broadcast-directly",label:"Broadcast directly",default:!0,children:(0,n.jsxs)(s.A,{groupId:"charon-single-all",children:[(0,n.jsxs)(o.A,{value:"charon-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command fetches full exit and broadcasts it instantaneously for a specific validator."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit broadcast \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--validator-public-key="<VALIDATOR_PUBLIC_KEY>"\'\n'})})]}),(0,n.jsxs)(o.A,{value:"charon-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command fetches full exits and broadcasts them instantaneously for all the validators that have reached a partial exit threshold."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c 'charon exit broadcast \\\n--beacon-node-endpoints=\"http://lighthouse:5052\" \\\n--all'\n"})})]})]})}),(0,n.jsx)(o.A,{value:"charon-fetch-broadcast",label:"Fetch & Broadcast later",default:!0,children:(0,n.jsxs)(s.A,{groupId:"single-all",children:[(0,n.jsxs)(o.A,{value:"charon-single",label:"Single Validator",default:!0,children:[(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Download Exits"})," : The following command downloads the full exit signature for a specific public key and stores it in a file."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit fetch \\\n--validator-public-key="<VALIDATOR_PUBLIC_KEY>" \\\n--fetched-exit-path="/opt/charon/.charon"\'\n'})}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Broadcast Exits"})," : The following command uses the full exit signature for a specific public key from the file and broadcasts it to the network."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit broadcast \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--exit-from-file="/opt/charon/.charon/<FILENAME>"\'\'\n'})})]}),(0,n.jsxs)(o.A,{value:"charon-all",label:"All Validators",default:!0,children:[(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Download Exits"})," : The following command downloads the full exit signature for all the active public keys and stores it in a directory."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c 'charon exit fetch \\\n--all \\\n--fetched-exit-path=\"/opt/charon/.charon\"'\n"})}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Broadcast Exits"})," : The following command uses the full exit signatures from the directory and broadcasts it to the network."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit broadcast \\\n--all \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--exit-from-dir="/opt/charon/.charon"\'\n'})})]})]})})]})]}),(0,n.jsxs)(o.A,{value:"teku",label:"Teku",default:!0,children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"teku-single-all",children:[(0,n.jsxs)(o.A,{value:"teku-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-teku-1 /opt/teku/bin/teku voluntary-exit \\\n--beacon-node-api-endpoint="http://charon:3600/" \\\n--validator-public-keys=<PARTIAL_PUBLIC_KEY> \\\n--network=holesky \\\n--epoch=256 \\\n--confirmation-enabled=false\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<PARTIAL_PUBLIC_KEY>"})," with the partial pubkey found in the keystores in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),", under ",(0,n.jsx)(a.code,{children:"pubkey"})," field.\nTo which full pubkey a partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"teku-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs partial exits for all validator pubkeys and broadcast them instantaneously as soon as a full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-teku-1 /opt/teku/bin/teku voluntary-exit \\\n--beacon-node-api-endpoint="http://charon:3600/" \\\n--validator-keys="/opt/charon/validator_keys:/opt/charon/validator_keys" \\\n--network=holesky \\\n--epoch=256 \\\n--confirmation-enabled=false\n'})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsxs)(o.A,{value:"nimbus",label:"Nimbus",children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"nimbus-single-all",children:[(0,n.jsxs)(o.A,{value:"nimbus-single",label:"Single Validator",default:!0,children:[(0,n.jsxs)(a.p,{children:["Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created.\nIt copies all files and directories from the keystore path ",(0,n.jsx)("code",{children:"/home/user/data/charon"})," to the newly created ",(0,n.jsx)("code",{children:"/home/user/data/wd"})," directory.\nThe directory referenced here as ",(0,n.jsx)(a.code,{children:"/home/user/data/node0/"})," is the data directory specified on start of Nimbus. ",(0,n.jsx)(a.a,{href:"https://github.com/ObolNetwork/charon-distributed-validator-cluster/blob/4faf38a1fc20ad241a2672021b32c90bf7ac9eb9/nimbus/run.sh#L40",children:"As an example in CDVC"})," the ",(0,n.jsx)(a.code,{children:"/home/user/data/node2/"})," and ",(0,n.jsx)(a.code,{children:"/home/user/data/node5/"})," are used."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-nimbus-1 /bin/bash -c "\\\nmkdir -p /home/user/data/wd; \\\ncp -r /home/user/data/node0/ /home/user/data/wd/; \\\ncat /home/user/data/wd/node0/secrets/<PARTIAL_PUBLIC_KEY> | /home/user/nimbus_beacon_node deposits exit \\ \n    --rest-url=http://charon:3600/ \\\n    --validator=/home/user/data/wd/node0/validators/<PARTIAL_PUBLIC_KEY>/keystore.json \\\n    --epoch=256 \\\n    --data-dir=/home/user/data/wd/node0/;"\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<PARTIAL_PUBLIC_KEY>"})," with the partial pubkey found in the keystores in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),", under ",(0,n.jsx)(a.code,{children:"pubkey"})," field.\nTo which full pubkey a partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"nimbus-all",label:"All Validators",default:!0,children:[(0,n.jsxs)(a.p,{children:["Following command executes an interactive command inside the Nimbus VC container. It copies all files and directories from the keystore path ",(0,n.jsx)("code",{children:"/home/user/data/charon"})," to the newly created ",(0,n.jsx)("code",{children:"/home/user/data/wd"})," directory.\nThe directory referenced here as ",(0,n.jsx)(a.code,{children:"/home/user/data/node0/"})," is the data directory specified on start of Nimbus. ",(0,n.jsx)(a.a,{href:"https://github.com/ObolNetwork/charon-distributed-validator-cluster/blob/4faf38a1fc20ad241a2672021b32c90bf7ac9eb9/nimbus/run.sh#L40",children:"As an example in CDVC"})," the ",(0,n.jsx)(a.code,{children:"/home/user/data/node2/"})," and ",(0,n.jsx)(a.code,{children:"/home/user/data/node5/"})," are used."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-nimbus-1 /bin/bash -c "\\\nmkdir -p /home/user/data/wd; \\\ncp -r /home/user/data/node0/ /home/user/data/wd/; \\\n/home/user/nimbus_beacon_node deposits exit \\ \n    --rest-url=http://charon:3600/ \\\n    --all \\\n    --epoch=256 \\\n    --data-dir=/home/user/data/wd/node0/;"\n'})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsxs)(o.A,{value:"lodestar",label:"Lodestar",default:!0,children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"lodestar-single-all",children:[(0,n.jsxs)(o.A,{value:"lodestar-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-lodestar-1 node /usr/app/packages/cli/bin/lodestar validator voluntary-exit \\\n--beaconNodes="http://charon:3600" \\\n--pubkeys=<PARTIAL_PUBLIC_KEY> \\\n--network=holesky \\\n--exitEpoch=256 \\\n--dataDir=/opt/data \\\n--yes\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<PARTIAL_PUBLIC_KEY>"})," with the partial pubkey found in the keystores in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),", under ",(0,n.jsx)(a.code,{children:"pubkey"})," field.\nTo which full pubkey a partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"lodestar-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs partial exits for all validator pubkeys and broadcast them instantaneously as soon as a full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-lodestar-1 node /usr/app/packages/cli/bin/lodestar validator voluntary-exit \\\n--beaconNodes="http://charon:3600" \\\n--network=holesky \\\n--exitEpoch=256 \\\n--dataDir=/opt/data \\\n--yes\n'})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsxs)(o.A,{value:"lighthouse",label:"Lighthouse",default:!0,children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"lighthouse-single-all",children:[(0,n.jsxs)(o.A,{value:"lighthouse-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.admonition,{type:"note",children:(0,n.jsx)(a.p,{children:"Lighthouse VC cannot perform an exit for custom epoch and always uses the current one. This means you should coordinate your efforts between cluster peers, in order to sign the same payload.\nIf you sign exit messages in different epochs, signatures will not be aggregated as they will missmatch and new signing of exit messages needs to be done."})}),(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-lighthouse-1 /bin/bash -c '\\\nfile=\"/opt/charon/keys/keystore-<N>.json\"; \\\nfilename=$(basename $file);\nkeystore=${filename%.*};\nlighthouse account validator exit \\\n    --beacon-node http://charon:3600 \\\n    --keystore /opt/charon/keys/$keystore.json \\\n    --network holesky \\\n    --password-file /opt/charon/keys/$keystore.txt \\\n    --no-confirmation \\\n    --no-wait;'\n"})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<N>"})," with the keystore index. Keystore indeces can be found in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),". Each JSON file has a ",(0,n.jsx)(a.code,{children:"pubkey"})," field corresponding to the partial pubkey.\nTo which full pubkey this partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"lighthouse-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.admonition,{type:"note",children:(0,n.jsx)(a.p,{children:"Lighthouse VC cannot perform an exit for custom epoch and always uses the current one. This means you should coordinate your efforts between cluster peers, in order to sign the same payload.\nIf you sign exit messages in different epochs, signatures will not be aggregated as they will missmatch and new signing of exit messages needs to be done."})}),(0,n.jsx)(a.p,{children:"Following command executes an interactive command inside the Lighthouse VC container."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-lighthouse-1 /bin/bash -c '\\\nfor file in /opt/charon/keys/*; do \\\n    filename=$(basename $file);\n    if [[ $filename == *\".json\"* ]]; then\n        keystore=${filename%.*};\n        lighthouse account validator exit \\\n            --beacon-node http://charon:3600 \\\n            --keystore /opt/charon/keys/$keystore.json \\\n            --network holesky \\\n            --password-file /opt/charon/keys/$keystore.txt \\\n            --no-confirmation \\\n            --no-wait;\n        fi;\ndone;'\n"})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsx)(o.A,{value:"prysm",label:"Prysm",default:!0,children:(0,n.jsxs)(a.p,{children:["Currently voluntary exits through Prysm are not supported. This is because ",(0,n.jsx)("a",{href:"https://docs.prylabs.network/docs/wallet/exiting-a-validator",target:"_blank",children:"Prysm support voluntary exits only if both the validator client and the beacon node are running on Prysm"}),". Note that this is incompatible with Charon, as the Charon client intercepts the communication between the validator client and the consensus layer."]})}),(0,n.jsxs)(o.A,{value:"Dappnode",label:"Dappnode",children:[(0,n.jsx)("h2",{children:"Exit a distributed validator using DappNode"}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)(a.p,{children:"Navigate to the config tab of your Obol DappNode package. Click 'Packages', then click 'My Packages', and enter the Obol package. Go to the config tab. At the bottom right corner of the page, click on 'Show Advanced Editor'."}),(0,n.jsx)("img",{src:"/img/ConfigTabExit.png",alt:"Config Tab"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(a.p,{children:"The advanced editor config page provides ENV configs for each validator. Scroll to the validator number you want to exit and type \u201ctrue\u201d in the column opposite SIGN_EXIT."}),(0,n.jsx)("img",{src:"/img/TypeTrue.png",alt:"Config Tab"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(a.p,{children:"Scroll to the bottom of the page and click the 'update' button for the changes to take effect."}),(0,n.jsx)("img",{src:"/img/ExitUpdate.png",alt:"Config Tab"})]}),(0,n.jsx)("li",{children:(0,n.jsx)(a.p,{children:"Check your logs to confirm the exit process has started."})})]})]})]})}),(0,n.jsx)(o.A,{value:"Mainnet",label:"Mainnet",children:(0,n.jsxs)(s.A,{groupId:"charon-exits",children:[(0,n.jsxs)(o.A,{value:"charon",label:"Charon",default:!0,children:[(0,n.jsx)(a.p,{children:"Voluntary exit can be submitted directly through Charon. This approach is validator client agnostic as Charon abstracts validator client's native exit commands underneath."}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"charon-single-all",children:[(0,n.jsxs)(o.A,{value:"charon-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit sign \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--validator-public-key="<VALIDATOR_PUBLIC_KEY>" \\\n--exit-epoch=194048\'\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<VALIDATOR_PUBLIC_KEY>"})," with the validator's full pubkey (as visible in Ethereum)."]})]}),(0,n.jsxs)(o.A,{value:"charon-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs partial exits for all validators."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c 'charon exit sign \\\n--beacon-node-endpoints=\"http://lighthouse:5052\" \\\n--all \\\n--exit-epoch=194048'\n"})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor the Partial Exits' status"})}),(0,n.jsx)(a.p,{children:"After a threshold of signed partial exits from node operators in the cluster is accumulated, a full (complete) exit can be created.  For example, in the cluster below, only 2 out of 4 clusters have reached the threshold. Operators will have to wait for one more partial exit signature, either from operator 1 or 3 to create a full exit message."}),(0,n.jsx)("img",{src:"/img/PartialExitsStatus.png",alt:"Partial Exit Status"}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 3: Broadcast the full exit"})}),(0,n.jsx)(a.p,{children:"Once the partial exit threshold is reached, a full exit can be broadcasted from any of the operator. There are two options to do it, depending on your use-case"}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Fetch the full exit and broadcast instantaneously (Broadcast directly )"})," - users can choose it for a single validator or all validators in the cluster."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Fetch the full exit and broadcast it later(Fetch & Broadcast later )"})," - users can choose it for a single validator or all validators in the cluster."]}),"\n"]}),(0,n.jsxs)(s.A,{groupId:"charon-exit-broadcast-fetch",children:[(0,n.jsx)(o.A,{value:"charon-broadcast-directly",label:"Broadcast directly",default:!0,children:(0,n.jsxs)(s.A,{groupId:"single-all",children:[(0,n.jsxs)(o.A,{value:"charon-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command fetches full exit and broadcasts it instantaneously for a specific validator."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit broadcast \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--validator-public-key="<VALIDATOR_PUBLIC_KEY>"\'\n'})})]}),(0,n.jsxs)(o.A,{value:"charon-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command fetches full exits and broadcasts them instantaneously for all the validators that have reached a partial exit threshold."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c 'charon exit broadcast \\\n--beacon-node-endpoints=\"http://lighthouse:5052\" \\\n--all'\n"})})]})]})}),(0,n.jsx)(o.A,{value:"charon-fetch-broadcast",label:"Fetch & Broadcast",default:!0,children:(0,n.jsxs)(s.A,{groupId:"single-all",children:[(0,n.jsxs)(o.A,{value:"charon-single",label:"Single Validator",default:!0,children:[(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Download Exits"})," : The following command downloads the full exit signature for a specific public key and stores it in a file."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit fetch \\\n--validator-public-key="<VALIDATOR_PUBLIC_KEY>" \\\n--fetched-exit-path="/opt/charon/.charon"\'\n'})}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Broadcast Exits"})," : The following command uses the full exit signature for a specific public key from the file and broadcasts it to the network."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit broadcast \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--exit-from-file="/opt/charon/.charon/<FILENAME>"\'\'\n'})})]}),(0,n.jsxs)(o.A,{value:"charon-all",label:"All Validators",default:!0,children:[(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Download Exits"})," : The following command downloads the full exit signature for all the active public keys and stores it in a directory."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c 'charon exit fetch \\\n--all \\\n--fetched-exit-path=\"/opt/charon/.charon\"'\n"})}),(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Broadcast Exits"})," : The following command uses the full exit signatures from the directory and broadcasts it to the network."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-charon-1 /bin/sh -c \'charon exit broadcast \\\n--all \\\n--beacon-node-endpoints="http://lighthouse:5052" \\\n--exit-from-dir="/opt/charon/.charon"\'\n'})})]})]})})]})]}),(0,n.jsxs)(o.A,{value:"teku",label:"Teku",default:!0,children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"teku-single-all",children:[(0,n.jsxs)(o.A,{value:"teku-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-teku-1 /opt/teku/bin/teku voluntary-exit \\\n--beacon-node-api-endpoint="http://charon:3600/" \\\n--validator-public-keys=<PARTIAL_PUBLIC_KEY> \\\n--network=mainnet \\\n--epoch=194048 \\\n--confirmation-enabled=false\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<PARTIAL_PUBLIC_KEY>"})," with the partial pubkey found in the keystores in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),", under ",(0,n.jsx)(a.code,{children:"pubkey"})," field.\nTo which full pubkey a partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"teku-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs partial exits for all validator pubkeys and broadcast them instantaneously as soon as a full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-teku-1 /opt/teku/bin/teku voluntary-exit \\\n--beacon-node-api-endpoint="http://charon:3600/" \\\n--validator-keys="/opt/charon/validator_keys:/opt/charon/validator_keys" \\\n--network=mainnet \\\n--epoch=194048 \\\n--confirmation-enabled=false\n'})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsxs)(o.A,{value:"nimbus",label:"Nimbus",children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"nimbus-single-all",children:[(0,n.jsxs)(o.A,{value:"nimbus-single",label:"Single Validator",default:!0,children:[(0,n.jsxs)(a.p,{children:["Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created.\nIt copies all files and directories from the keystore path ",(0,n.jsx)("code",{children:"/home/user/data/charon"})," to the newly created ",(0,n.jsx)("code",{children:"/home/user/data/wd"})," directory.\nThe directory referenced here as ",(0,n.jsx)(a.code,{children:"/home/user/data/node0/"})," is the data directory specified on start of Nimbus. ",(0,n.jsx)(a.a,{href:"https://github.com/ObolNetwork/charon-distributed-validator-cluster/blob/4faf38a1fc20ad241a2672021b32c90bf7ac9eb9/nimbus/run.sh#L40",children:"As an example in CDVC"})," the ",(0,n.jsx)(a.code,{children:"/home/user/data/node2/"})," and ",(0,n.jsx)(a.code,{children:"/home/user/data/node5/"})," are used."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-nimbus-1 /bin/bash -c "\\\nmkdir -p /home/user/data/wd; \\\ncp -r /home/user/data/node0/ /home/user/data/wd/; \\\ncat /home/user/data/wd/node0/secrets/<PARTIAL_PUBLIC_KEY> | /home/user/nimbus_beacon_node deposits exit \\ \n    --rest-url=http://charon:3600/ \\\n    --validator=/home/user/data/wd/node0/validators/<PARTIAL_PUBLIC_KEY>/keystore.json \\\n    --epoch=194048 \\\n    --data-dir=/home/user/data/wd/node0/;"\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<PARTIAL_PUBLIC_KEY>"})," with the partial pubkey found in the keystores in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),", under ",(0,n.jsx)(a.code,{children:"pubkey"})," field.\nTo which full pubkey a partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"nimbus-all",label:"All Validators",default:!0,children:[(0,n.jsxs)(a.p,{children:["Following command executes an interactive command inside the Nimbus VC container. It copies all files and directories from the keystore path ",(0,n.jsx)("code",{children:"/home/user/data/charon"})," to the newly created ",(0,n.jsx)("code",{children:"/home/user/data/wd"})," directory.\nThe directory referenced here as ",(0,n.jsx)(a.code,{children:"/home/user/data/node0/"})," is the data directory specified on start of Nimbus. ",(0,n.jsx)(a.a,{href:"https://github.com/ObolNetwork/charon-distributed-validator-cluster/blob/4faf38a1fc20ad241a2672021b32c90bf7ac9eb9/nimbus/run.sh#L40",children:"As an example in CDVC"})," the ",(0,n.jsx)(a.code,{children:"/home/user/data/node2/"})," and ",(0,n.jsx)(a.code,{children:"/home/user/data/node5/"})," are used."]}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-nimbus-1 /bin/bash -c "\\\nmkdir -p /home/user/data/wd; \\\ncp -r /home/user/data/node0/ /home/user/data/wd/; \\\n/home/user/nimbus_beacon_node deposits exit \\ \n    --rest-url=http://charon:3600/ \\\n    --all \\\n    --epoch=194048 \\\n    --data-dir=/home/user/data/wd/node0/;"\n'})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsxs)(o.A,{value:"lodestar",label:"Lodestar",default:!0,children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"lodestar-single-all",children:[(0,n.jsxs)(o.A,{value:"lodestar-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-lodestar-1 node /usr/app/packages/cli/bin/lodestar validator voluntary-exit \\\n--beaconNodes="http://charon:3600" \\\n--pubkeys=<PARTIAL_PUBLIC_KEY> \\\n--network=mainnet \\\n--exitEpoch=194048 \\\n--dataDir=/opt/data \\\n--yes\n'})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<PARTIAL_PUBLIC_KEY>"})," with the partial pubkey found in the keystores in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),", under ",(0,n.jsx)(a.code,{children:"pubkey"})," field.\nTo which full pubkey a partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"lodestar-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.p,{children:"Following command signs partial exits for all validator pubkeys and broadcast them instantaneously as soon as a full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:'docker exec -it charon-distributed-validator-node-lodestar-1 node /usr/app/packages/cli/bin/lodestar validator voluntary-exit \\\n--beaconNodes="http://charon:3600" \\\n--network=mainnet \\\n--exitEpoch=194048 \\\n--dataDir=/opt/data \\\n--yes\n'})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsxs)(o.A,{value:"lighthouse",label:"Lighthouse",default:!0,children:[(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 1: Submit partial exit"})}),(0,n.jsxs)(s.A,{groupId:"lighthouse-single-all",children:[(0,n.jsxs)(o.A,{value:"lighthouse-single",label:"Single Validator",default:!0,children:[(0,n.jsx)(a.admonition,{type:"note",children:(0,n.jsx)(a.p,{children:"Lighthouse VC cannot perform an exit for custom epoch and always uses the current one. This means you should coordinate your efforts between cluster peers, in order to sign the same payload.\nIf you sign exit messages in different epochs, signatures will not be aggregated as they will missmatch and new signing of exit messages needs to be done."})}),(0,n.jsx)(a.p,{children:"Following command signs a partial exit for a specific validator pubkey and broadcasts it instantaneously as soon as full exit can be created."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-lighthouse-1 /bin/bash -c '\\\nfile=\"/opt/charon/keys/keystore-<N>.json\"; \\\nfilename=$(basename $file);\nkeystore=${filename%.*};\nlighthouse account validator exit \\\n    --beacon-node http://charon:3600 \\\n    --keystore /opt/charon/keys/$keystore.json \\\n    --network mainnet \\\n    --password-file /opt/charon/keys/$keystore.txt \\\n    --no-confirmation \\\n    --no-wait;'\n"})}),(0,n.jsxs)(a.p,{children:["Replace ",(0,n.jsx)(a.code,{children:"<N>"})," with the keystore index. Keystore indeces can be found in ",(0,n.jsx)(a.code,{children:".charon/validator_keys/"}),". Each JSON file has a ",(0,n.jsx)(a.code,{children:"pubkey"})," field corresponding to the partial pubkey.\nTo which full pubkey this partial pubkey corresponds (as visible in Ethereum), can be looked up in the ",(0,n.jsx)(a.code,{children:".charon/cluster-lock.json"}),", under ",(0,n.jsx)(a.code,{children:"distributed_validators"})," field."]})]}),(0,n.jsxs)(o.A,{value:"lighthouse-all",label:"All Validators",default:!0,children:[(0,n.jsx)(a.admonition,{type:"note",children:(0,n.jsx)(a.p,{children:"Lighthouse VC cannot perform an exit for custom epoch and always uses the current one. This means you should coordinate your efforts between cluster peers, in order to sign the same payload.\nIf you sign exit messages in different epochs, signatures will not be aggregated as they will missmatch and new signing of exit messages needs to be done."})}),(0,n.jsx)(a.p,{children:"Following command executes an interactive command inside the Lighthouse VC container."}),(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-shell",children:"docker exec -it charon-distributed-validator-node-lighthouse-1 /bin/bash -c '\\\nfor file in /opt/charon/keys/*; do \\\n    filename=$(basename $file);\n    if [[ $filename == *\".json\"* ]]; then\n        keystore=${filename%.*};\n        lighthouse account validator exit \\\n            --beacon-node http://charon:3600 \\\n            --keystore /opt/charon/keys/$keystore.json \\\n            --network mainnet \\\n            --password-file /opt/charon/keys/$keystore.txt \\\n            --no-confirmation \\\n            --no-wait;\n        fi;\ndone;'\n"})})]})]}),(0,n.jsx)(a.p,{children:(0,n.jsx)(a.strong,{children:"Step 2: Monitor partial exit for all active validators"})}),(0,n.jsx)(a.p,{children:"Consult the examples below and compare them to your validator's monitoring to verify that exits from each operator in the cluster are being received. This example is a cluster of 4 nodes with 2 validators and threshold of 3 nodes broadcasting exits are needed."}),(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Operator 1 broadcasts an exit on validator client 1.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(38755).A+"",width:"2988",height:"1226"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(90869).A+"",width:"2152",height:"548"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 2 broadcasts an exit on validator client 2.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(1896).A+"",width:"2974",height:"952"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(70494).A+"",width:"2152",height:"582"})]}),"\n",(0,n.jsxs)(a.li,{children:["Operator 3 broadcasts an exit on validator client 3.\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(12113).A+"",width:"2924",height:"1018"}),"\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(46279).A+"",width:"2144",height:"608"})]}),"\n"]}),(0,n.jsxs)(a.p,{children:["At this point, the threshold of 3 has been reached and the validator exit process will start. The logs will show the following:\n",(0,n.jsx)(a.img,{alt:"Verify in Grafana Exit panel",src:t(80300).A+"",width:"2784",height:"484"})]})]}),(0,n.jsx)(o.A,{value:"prysm",label:"Prysm",default:!0,children:(0,n.jsxs)(a.p,{children:["Currently voluntary exits through Prysm are not supported. This is because ",(0,n.jsx)("a",{href:"https://docs.prylabs.network/docs/wallet/exiting-a-validator",target:"_blank",children:"Prysm support voluntary exits only if both the validator client and the beacon node are running on Prysm"}),". Note that this is incompatible with Charon, as the Charon client intercepts the communication between the validator client and the consensus layer."]})}),(0,n.jsxs)(o.A,{value:"Dappnode",label:"Dappnode",children:[(0,n.jsx)("h2",{children:"Exit a distributed validator using DappNode"}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)(a.p,{children:"Navigate to the config tab of your Obol DappNode package. Click 'Packages', then click 'My Packages', and enter the Obol package. Go to the config tab. At the bottom right corner of the page, click on 'Show Advanced Editor'."}),(0,n.jsx)("img",{src:"/img/ConfigTabExit.png",alt:"Config Tab"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(a.p,{children:"The advanced editor config page provides ENV configs for each validator. Scroll to the validator number you want to exit and type \u201ctrue\u201d in the column opposite SIGN_EXIT."}),(0,n.jsx)("img",{src:"/img/TypeTrue.png",alt:"Config Tab"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(a.p,{children:"Scroll to the bottom of the page and click the 'update' button for the changes to take effect."}),(0,n.jsx)("img",{src:"/img/ExitUpdate.png",alt:"Config Tab"})]}),(0,n.jsx)("li",{children:(0,n.jsx)(a.p,{children:"Check your logs to confirm the exit process has started."})})]})]})]})})]}),"\n",(0,n.jsx)(a.admonition,{type:"tip",children:(0,n.jsx)(a.p,{children:"Once a validator has broadcasted an exit message, it must continue to validate for at least 27 hours or longer. Do not shut off your distributed validator nodes until your validator is fully exited."})}),"\n",(0,n.jsx)(a.h2,{id:"exit-epoch-and-withdrawable-epoch",children:"Exit epoch and withdrawable epoch"}),"\n",(0,n.jsx)(a.p,{children:"The process of a validator exiting from staking takes variable amounts of time, depending on how many others are exiting at the same time."}),"\n",(0,n.jsx)(a.p,{children:"Immediately upon broadcasting a signed voluntary exit message, the exit epoch and withdrawable epoch values are calculated based off the current epoch number. These values determine exactly when the validator will no longer be required to be online performing validation, and when the validator is eligible for a full withdrawal respectively."}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:["Exit epoch - epoch at which your validator is no longer active, no longer earning rewards, and is no longer subject to slashing rules.","\n",(0,n.jsx)(a.admonition,{type:"warning",children:(0,n.jsx)(a.p,{children:'Up until this epoch (while "in the queue") your validator is expected to be online and is held to the same slashing rules as always. Do not turn your DV node off until this epoch is reached.'})}),"\n"]}),"\n",(0,n.jsx)(a.li,{children:"Withdrawable epoch - epoch at which your validator funds are eligible for a full withdrawal during the next validator sweep.\nThis occurs 256 epochs after the exit epoch, which takes ~27.3 hours."}),"\n"]})]})}function x(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},7227:(e,a,t)=>{t.d(a,{A:()=>s});t(96540);var i=t(34164);const n={tabItem:"tabItem_Ymn6"};var r=t(74848);function s(e){let{children:a,hidden:t,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.A)(n.tabItem,s),hidden:t,children:a})}},49489:(e,a,t)=>{t.d(a,{A:()=>w});var i=t(96540),n=t(34164),r=t(24245),s=t(56347),o=t(36494),l=t(62814),d=t(45167),c=t(69900);function h(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:a,children:t}=e;return(0,i.useMemo)((()=>{const e=a??function(e){return h(e).map((e=>{let{props:{value:a,label:t,attributes:i,default:n}}=e;return{value:a,label:t,attributes:i,default:n}}))}(t);return function(e){const a=(0,d.XI)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,t])}function x(e){let{value:a,tabValues:t}=e;return t.some((e=>e.value===a))}function p(e){let{queryString:a=!1,groupId:t}=e;const n=(0,s.W6)(),r=function(e){let{queryString:a=!1,groupId:t}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:a,groupId:t});return[(0,l.aZ)(r),(0,i.useCallback)((e=>{if(!r)return;const a=new URLSearchParams(n.location.search);a.set(r,e),n.replace({...n.location,search:a.toString()})}),[r,n])]}function f(e){const{defaultValue:a,queryString:t=!1,groupId:n}=e,r=u(e),[s,l]=(0,i.useState)((()=>function(e){let{defaultValue:a,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!x({value:a,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const i=t.find((e=>e.default))??t[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:a,tabValues:r}))),[d,h]=p({queryString:t,groupId:n}),[f,g]=function(e){let{groupId:a}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(a),[n,r]=(0,c.Dv)(t);return[n,(0,i.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:n}),b=(()=>{const e=d??f;return x({value:e,tabValues:r})?e:null})();(0,o.A)((()=>{b&&l(b)}),[b]);return{selectedValue:s,selectValue:(0,i.useCallback)((e=>{if(!x({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),g(e)}),[h,g,r]),tabValues:r}}var g=t(11062);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var m=t(74848);function j(e){let{className:a,block:t,selectedValue:i,selectValue:s,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,r.a_)(),c=e=>{const a=e.currentTarget,t=l.indexOf(a),n=o[t].value;n!==i&&(d(a),s(n))},h=e=>{let a=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;a=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;a=l[t]??l[l.length-1];break}}a?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":t},a),children:o.map((e=>{let{value:a,label:t,attributes:r}=e;return(0,m.jsx)("li",{role:"tab",tabIndex:i===a?0:-1,"aria-selected":i===a,ref:e=>l.push(e),onKeyDown:h,onClick:c,...r,className:(0,n.A)("tabs__item",b.tabItem,r?.className,{"tabs__item--active":i===a}),children:t??a},a)}))})}function y(e){let{lazy:a,children:t,selectedValue:r}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){const e=s.find((e=>e.props.value===r));return e?(0,i.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:s.map(((e,a)=>(0,i.cloneElement)(e,{key:a,hidden:e.props.value!==r})))})}function v(e){const a=f(e);return(0,m.jsxs)("div",{className:(0,n.A)("tabs-container",b.tabList),children:[(0,m.jsx)(j,{...a,...e}),(0,m.jsx)(y,{...a,...e})]})}function w(e){const a=(0,g.A)();return(0,m.jsx)(v,{...e,children:h(e.children)},String(a))}},90869:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/DutyExit-01-cc29cb51c323e290f8ceec9c0256f574.png"},70494:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/DutyExit-02-560e45e9e4064f1ca26a0386f8d7ec16.png"},46279:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/DutyExit-03-12edb85f9744e0ff91264177f37fb753.png"},80300:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/ExitLogs-04a7bf322d265372eac30d3671bd916b.png"},38755:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/ExitPromQuery-01-7266f9324d942a47c7966bf2f036f167.png"},1896:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/ExitPromQuery-02-9592e27d4d27ab70911856badffa662a.png"},12113:(e,a,t)=>{t.d(a,{A:()=>i});const i=t.p+"assets/images/ExitPromQuery-03-d2adbd3dec918750799fe3f07309bed3.png"}}]);