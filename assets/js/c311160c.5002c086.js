"use strict";(self.webpackChunkobol_docs=self.webpackChunkobol_docs||[]).push([[73297],{82311:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=n(74848),a=n(28453);n(49489),n(7227);const s={sidebar_position:5,description:"Test the performance of a candidate Distributed Validator Cluster setup."},i="Test a Cluster",o={id:"advanced/test-command",title:"Test a Cluster",description:"Test the performance of a candidate Distributed Validator Cluster setup.",source:"@site/docs/advanced/test-command.md",sourceDirName:"advanced",slug:"/advanced/test-command",permalink:"/docs/next/advanced/test-command",draft:!1,unlisted:!1,editUrl:"https://github.com/ObolNetwork/obol-docs/edit/main/docs/advanced/test-command.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,description:"Test the performance of a candidate Distributed Validator Cluster setup."},sidebar:"tutorialSidebar",previous:{title:"Create an EigenLayer DV",permalink:"/docs/next/advanced/quickstart-eigenpod"},next:{title:"Split validator private keys",permalink:"/docs/next/advanced/quickstart-split"}},l={},c=[{value:"Test your connection to peers",id:"test-your-connection-to-peers",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Run",id:"run",level:3},{value:"Run with Docker",id:"run-with-docker",level:3},{value:"Test your beacon node",id:"test-your-beacon-node",level:2},{value:"Pre-requisites",id:"pre-requisites-1",level:3},{value:"Run",id:"run-1",level:3},{value:"Run with Docker",id:"run-with-docker-1",level:3},{value:"Test your validator client",id:"test-your-validator-client",level:2},{value:"Pre-requisites",id:"pre-requisites-2",level:3},{value:"Run",id:"run-2",level:3},{value:"Run with Docker",id:"run-with-docker-2",level:3},{value:"Test MEV relay",id:"test-mev-relay",level:2},{value:"Pre-requisites",id:"pre-requisites-3",level:3},{value:"Run",id:"run-3",level:3},{value:"Run with Docker",id:"run-with-docker-3",level:3},{value:"Test your machine and network performance",id:"test-your-machine-and-network-performance",level:2},{value:"Pre-requisites",id:"pre-requisites-4",level:3},{value:"Run",id:"run-4",level:3},{value:"Run with Docker",id:"run-with-docker-4",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"test-a-cluster",children:"Test a Cluster"})}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"charon alpha test"})," command is in an alpha state and is subject to change until it is made available as ",(0,r.jsx)(t.code,{children:"charon test"})," in a future version."]})}),"\n",(0,r.jsxs)(t.p,{children:["Charon test commands are designed to help you evaluate the performance and readiness of your candidate cluster. It allows you to test your connection to other Charon peers, the performance of your beacon node(s), and the readiness of your validator client. It prints a performance report to the standard output (which can be omitted by with the ",(0,r.jsx)(t.code,{children:"--quiet"})," flag) and a machine-readable TOML format of the report if the ",(0,r.jsx)(t.code,{children:"--output-toml"})," flag is set."]}),"\n",(0,r.jsx)(t.h2,{id:"test-your-connection-to-peers",children:"Test your connection to peers"}),"\n",(0,r.jsxs)(t.p,{children:["Run tests towards other Charon peers to evaluate the effectiveness of a potential cluster setup. The command sets up a libp2p node, similarly to what Charon normally does. This test command ",(0,r.jsx)(t.strong,{children:"has to be running simultaneously with the other peers"}),". After the node is up it waits for other peers to get their nodes up and running, retrying the connection every 3 seconds. The libp2p node connects to relays (configurable with ",(0,r.jsx)(t.code,{children:"p2p-relays"})," flag) and to other libp2p nodes via TCP. Other peer nodes are discoverable by using their ENRs. Note that for a peer to be successfully discovered, it needs to be connected to the same relay. After completion of the test suite the libp2p node stays alive (duration configurable with ",(0,r.jsx)(t.code,{children:"keep-alive"})," flag) for other peers to continue testing against it. The node can be forcefully stopped as well."]}),"\n",(0,r.jsx)(t.p,{children:"To be able to establish direct connection, you have to ensure:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Your machine is publicly accessible on the internet or at least a specific port is."}),"\n",(0,r.jsxs)(t.li,{children:["You add flag ",(0,r.jsx)(t.code,{children:"p2p-tcp-address"})," (i.e.: ",(0,r.jsx)(t.code,{children:"127.0.0.1:9001"}),") flag and the port specified in it is free and publicly accessible."]}),"\n",(0,r.jsxs)(t.li,{children:["You add the flag ",(0,r.jsx)(t.code,{children:"p2p-external-ip"})," (i.e.: ",(0,r.jsx)(t.code,{children:"8.8.8.8"}),") and specify your public ip."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"If all points are satisfied by you and the other peers, you should be able to establish a direct TCP connection between each other. Note that a relay is still required, as it is used for peer discovery."}),"\n",(0,r.jsxs)(t.p,{children:["At least 1 enr is required to be supplied to the ",(0,r.jsx)(t.code,{children:"--enrs"})," flag."]}),"\n",(0,r.jsx)(t.h3,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"../charon/charon-cli-reference#creating-an-enr-for-charon",children:"Create an ENR"}),"."]}),"\n",(0,r.jsx)(t.li,{children:"Share your ENR with the other peers which will test with you."}),"\n",(0,r.jsx)(t.li,{children:"Obtain the ENRs of the other peers with which you will test."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"run",children:"Run"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'charon alpha test peers \\\n  --enrs="enr:-HW4QNDXi9MzdH9Af65g20jDfelAJ0kJhclitkYYgFziYHXhRFF6JyB_CnVnimB7VxKBGBSkHbmy-Tu8BJq8JQkfptiAgmlkgnY0iXNlY3AyNTZrMaEDBVt5pk6x0A2fjth25pjLOEE9DpqCG-BCYyvutY04TZ,enr:-HW4QO2vefLueTBEUGly5hkcpL7NWdMKWx7Nuy9f7z6XZInCbFAc0IZj6bsnmj-Wi4ElS6jNa0Mge5Rkc2WGTVemas2AgmlkgnY0iXNlY3AyNTZrMaECR9SmYQ_1HRgJmNxvh_ER2Sxx78HgKKgKaOkCROYwaDY"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"run-with-docker",children:"Run with Docker"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'docker run -v /Users/obol/charon/.charon:/opt/charon/.charon obolnetwork/charon:v1.1.0 alpha test peers \\\n  --enrs="enr:-HW4QNDXi9MzdH9Af65g20jDfelAJ0kJhclitkYYgFziYHXhRFF6JyB_CnVnimB7VxKBGBSkHbmy-Tu8BJq8JQkfptiAgmlkgnY0iXNlY3AyNTZrMaEDBVt5pk6x0A2fjth25pjLOEE9DpqCG-BCYyvutY04TZs,enr:-HW4QO2vefLueTBEUGly5hkcpL7NWdMKWx7Nuy9f7z6XZInCbFAc0IZj6bsnmj-Wi4ElS6jNa0Mge5Rkc2WGTVemas2AgmlkgnY0iXNlY3AyNTZrMaECR9SmYQ_1HRgJmNxvh_ER2Sxx78HgKKgKaOkCROYwaDY"\n'})}),"\n",(0,r.jsx)(t.h2,{id:"test-your-beacon-node",children:"Test your beacon node"}),"\n",(0,r.jsxs)(t.p,{children:["Run tests towards beacon node(s), to evaluate its effectiveness for a Distributed Validator cluster. The beacon node is usually the instance getting the most load, especially with high number of validators serviced by the validator client and Charon. If the beacon node is self-hosted (which is highly recommended), the flag ",(0,r.jsx)(t.code,{children:"--enable-load-test"})," can be added."]}),"\n",(0,r.jsxs)(t.p,{children:["At least 1 endpoint is required to be supplied to the ",(0,r.jsx)(t.code,{children:"--endpoints"})," flag."]}),"\n",(0,r.jsx)(t.h3,{id:"pre-requisites-1",children:"Pre-requisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Running beacon node(s) towards which tests will be executed."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"run-1",children:"Run"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'charon alpha test beacon \\\n  --endpoints="https://ethereum-holesky-beacon-api.publicnode.com,https://ethereum-sepolia-beacon-api.publicnode.com"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"run-with-docker-1",children:"Run with Docker"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'docker run obolnetwork/charon:v1.1.0 alpha test beacon \\\n  --endpoints="https://ethereum-holesky-beacon-api.publicnode.com,https://ethereum-sepolia-beacon-api.publicnode.com"\n'})}),"\n",(0,r.jsx)(t.h2,{id:"test-your-validator-client",children:"Test your validator client"}),"\n",(0,r.jsx)(t.p,{children:"Run tests towards your validator client, to evaluate its effectiveness for a Distributed Validator cluster."}),"\n",(0,r.jsxs)(t.p,{children:["Default endpoint for validator and port is used at ",(0,r.jsx)(t.code,{children:"127.0.0.1:3600"}),". This can be changed by supplying different endpoint to the ",(0,r.jsx)(t.code,{children:"--validator-api-address"})," flag."]}),"\n",(0,r.jsx)(t.h3,{id:"pre-requisites-2",children:"Pre-requisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Running validator client towards which tests will be executed."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"run-2",children:"Run"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"charon alpha test validator\n"})}),"\n",(0,r.jsx)(t.h3,{id:"run-with-docker-2",children:"Run with Docker"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"docker run obolnetwork/charon:v1.1.0 alpha test validator\n"})}),"\n",(0,r.jsx)(t.h2,{id:"test-mev-relay",children:"Test MEV relay"}),"\n",(0,r.jsx)(t.p,{children:"Run tests towards MEV relay(s), to evaluate its effectiveness for a Distributed Validator cluster. If a MEV boost instance is configured for the validator node, it is of utmost importance that the connection to it is fast. If not, the chance of missing a block proposal raises significantly, because of a slow building of the block from the MEV."}),"\n",(0,r.jsxs)(t.p,{children:["At least 1 endpoint is required to be supplied to the ",(0,r.jsx)(t.code,{children:"--endpoints"})," flag."]}),"\n",(0,r.jsx)(t.h3,{id:"pre-requisites-3",children:"Pre-requisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Running MEV relay(s) towards which tests will be executed."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"run-3",children:"Run"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'charon alpha test mev \\\n  --endpoints="https://0xac6e77dfe25ecd6110b8e780608cce0dab71fdd5ebea22a16c0205200f2f8e2e3ad3b71d3499c54ad14d6c21b41a37ae@boost-relay.flashbots.net"\n'})}),"\n",(0,r.jsx)(t.h3,{id:"run-with-docker-3",children:"Run with Docker"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'docker run obolnetwork/charon:v1.1.0 alpha test mev \\\n  --endpoints="https://0xac6e77dfe25ecd6110b8e780608cce0dab71fdd5ebea22a16c0205200f2f8e2e3ad3b71d3499c54ad14d6c21b41a37ae@boost-relay.flashbots.net"\n'})}),"\n",(0,r.jsx)(t.h2,{id:"test-your-machine-and-network-performance",children:"Test your machine and network performance"}),"\n",(0,r.jsx)(t.p,{children:"Run tests towards your machine and network, to evaluate its effectiveness for a Distributed Validator cluster. While Charon does not require highly performant hardware, the network connectivity of the machine it is running on should be good. In comparison, the beacon node requires not only good connectivity, but also performant storage with high input-output operations per second, enough memory and also good network connectivity. This test aims to address all those requirements and give a good overview of the system."}),"\n",(0,r.jsxs)(t.p,{children:["Note that the storage tests require ",(0,r.jsx)(t.code,{children:"fio"})," installed. ",(0,r.jsx)(t.code,{children:"fio"})," is already pre-installed in the Docker images. Read more about ",(0,r.jsx)(t.code,{children:"fio"})," ",(0,r.jsx)(t.a,{href:"https://fio.readthedocs.io/en/latest/fio_doc.html",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"pre-requisites-4",children:"Pre-requisites"}),"\n",(0,r.jsx)(t.p,{children:"None."}),"\n",(0,r.jsx)(t.h3,{id:"run-4",children:"Run"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"charon alpha test performance\n"})}),"\n",(0,r.jsx)(t.h3,{id:"run-with-docker-4",children:"Run with Docker"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"docker run obolnetwork/charon:v1.1.0 alpha test performance\n"})}),"\n",(0,r.jsx)(t.p,{children:"For proper examination of the disk performance, it is advised to run the tests in a Docker volume."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"docker run -v ${HOME}/charon/test:/opt/charon/test obolnetwork/charon:v1.1.0 alpha test performance \\\n  --disk-io-test-file-dir=/opt/charon/test\n"})})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7227:(e,t,n)=>{n.d(t,{A:()=>i});n(96540);var r=n(34164);const a={tabItem:"tabItem_Ymn6"};var s=n(74848);function i(e){let{children:t,hidden:n,className:i}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,i),hidden:n,children:t})}},49489:(e,t,n)=>{n.d(t,{A:()=>w});var r=n(96540),a=n(34164),s=n(24245),i=n(56347),o=n(36494),l=n(62814),c=n(45167),d=n(69900);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(a.location.search);t.set(s,e),a.replace({...a.location,search:t.toString()})}),[s,a])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=h(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[c,u]=f({queryString:n,groupId:a}),[b,m]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,s]=(0,d.Dv)(n);return[a,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:a}),v=(()=>{const e=c??b;return p({value:e,tabValues:s})?e:null})();(0,o.A)((()=>{v&&l(v)}),[v]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),m(e)}),[u,m,s]),tabValues:s}}var m=n(11062);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=n(74848);function g(e){let{className:t,block:n,selectedValue:r,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),d=e=>{const t=e.currentTarget,n=l.indexOf(t),a=o[n].value;a!==r&&(c(t),i(a))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},t),children:o.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>l.push(e),onKeyDown:u,onClick:d,...s,className:(0,a.A)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:s}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function y(e){const t=b(e);return(0,x.jsxs)("div",{className:(0,a.A)("tabs-container",v.tabList),children:[(0,x.jsx)(g,{...t,...e}),(0,x.jsx)(j,{...t,...e})]})}function w(e){const t=(0,m.A)();return(0,x.jsx)(y,{...e,children:u(e.children)},String(t))}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var r=n(96540);const a={},s=r.createContext(a);function i(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);